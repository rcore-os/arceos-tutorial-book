## QEMU æ¨¡æ‹Ÿå™¨å®‰è£…

æˆ‘ä»¬éœ€è¦ä½¿ç”¨ QEMU 7.0 ç‰ˆæœ¬è¿›è¡Œå®éªŒï¼Œä½ç‰ˆæœ¬çš„ QEMU å¯èƒ½å¯¼è‡´æ¡†æ¶ä»£ç ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚è€Œå¾ˆå¤š Linux å‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ç®¡ç†å™¨é»˜è®¤è½¯ä»¶æºä¸­çš„ QEMU ç‰ˆæœ¬è¿‡ä½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»æºç æ‰‹åŠ¨ç¼–è¯‘å®‰è£… QEMU æ¨¡æ‹Ÿå™¨è½¯ä»¶ã€‚ä¸‹é¢ä»¥ Ubuntu 22.04 ä¸Šçš„å®‰è£…æµç¨‹ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼š

é¦–å…ˆæˆ‘ä»¬å®‰è£…ä¾èµ–åŒ…ï¼Œè·å– QEMU æºä»£ç å¹¶æ‰‹åŠ¨ç¼–è¯‘ï¼š

```
# å®‰è£…ç¼–è¯‘æ‰€éœ€çš„ä¾èµ–åŒ…
sudo apt install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev \
              gawk build-essential bison flex texinfo gperf libtool patchutils bc \
              zlib1g-dev libexpat-dev pkg-config  libglib2.0-dev libpixman-1-dev libsdl2-dev \
              git tmux python3 python3-pip ninja-build
# ä¸‹è½½æºç åŒ…
# å¦‚æœä¸‹è½½é€Ÿåº¦è¿‡æ…¢å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç™¾åº¦ç½‘ç›˜é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dykndFzY73nqkPL2QXs32Q
# æå–ç ï¼šjimc
wget https://download.qemu.org/qemu-7.0.0.tar.xz
# è§£å‹
tar xvJf qemu-7.0.0.tar.xz
# ç¼–è¯‘å®‰è£…å¹¶é…ç½® RISC-V æ”¯æŒ
cd qemu-7.0.0
./configure --target-list=riscv64-softmmu,riscv64-linux-user  # å¦‚æœè¦æ”¯æŒå›¾å½¢ç•Œé¢ï¼Œå¯æ·»åŠ  " --enable-sdl" å‚æ•°
make -j$(nproc)
```

<font color=blue>**æ³¨è§£ğŸ‘‰**</font>

æ³¨æ„ï¼Œä¸Šé¢çš„ä¾èµ–åŒ…å¯èƒ½å¹¶ä¸å®Œå…¨ï¼Œæ¯”å¦‚åœ¨ Ubuntu 18.04 ä¸Šï¼š

- å‡ºç° `ERROR: pkg-config binary 'pkg-config' not found` æ—¶ï¼Œå¯ä»¥å®‰è£… `pkg-config` åŒ…ï¼›
- å‡ºç° `ERROR: glib-2.48 gthread-2.0 is required to compile QEMU` æ—¶ï¼Œå¯ä»¥å®‰è£… `libglib2.0-dev` åŒ…ï¼›
- å‡ºç° `ERROR: pixman >= 0.21.8 not present` æ—¶ï¼Œå¯ä»¥å®‰è£… `libpixman-1-dev` åŒ…ã€‚

---

å¦å¤–ä¸€äº› Linux å‘è¡Œç‰ˆç¼–è¯‘ QEMU çš„ä¾èµ–åŒ…å¯ä»¥ä» [è¿™é‡Œ](https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html#prerequisites) æ‰¾åˆ°ã€‚

ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨åŒç›®å½•ä¸‹ `sudo make install` å°† QEMU å®‰è£…åˆ° `/usr/local/bin` ç›®å½•ä¸‹ï¼Œä½†è¿™æ ·ç»å¸¸ä¼šå¼•èµ·å†²çªã€‚ä¸ªäººæ¥è¯´æ›´ä¹ æƒ¯çš„åšæ³•æ˜¯ï¼Œç¼–è¾‘ `~/.bashrc` æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ `bash` ç»ˆç«¯ï¼‰ï¼Œåœ¨æ–‡ä»¶çš„æœ«å°¾åŠ å…¥å‡ è¡Œï¼š

```
# è¯·æ³¨æ„ï¼Œqemu-7.0.0 çš„çˆ¶ç›®å½•å¯ä»¥éšç€ä½ çš„å®é™…å®‰è£…ä½ç½®çµæ´»è°ƒæ•´
export PATH=$PATH:/path/to/qemu-7.0.0/build
```

éšåå³å¯åœ¨å½“å‰ç»ˆç«¯ `source ~/.bashrc` æ›´æ–°ç³»ç»Ÿè·¯å¾„ï¼Œæˆ–è€…ç›´æ¥é‡å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ã€‚

æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç¡®è®¤ QEMU çš„ç‰ˆæœ¬ï¼š

```
qemu-system-riscv64 --version
qemu-riscv64 --version
```

<font color=red>**è­¦å‘Šï¼**</font>

è¯·å°½é‡ä¸è¦å®‰è£… `qemu-kvm` ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ¡†æ¶æ— æ³•æ­£å¸¸è¿è¡Œã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä»…åœ¨ Qemu 7.0.0 ç‰ˆæœ¬ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œè¯·å°½é‡ä¸è¦åˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬ã€‚
