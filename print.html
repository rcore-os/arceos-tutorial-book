<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Arceos Tutorial Book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">ç®€æ˜ Arceos Tutorial Book</a></li><li class="chapter-item expanded "><a href="ch01-00.html"><strong aria-hidden="true">1.</strong> å®éªŒç¯å¢ƒé…ç½®</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch01-01.html"><strong aria-hidden="true">1.1.</strong> OS ç¯å¢ƒé…ç½®</a></li><li class="chapter-item expanded "><a href="ch01-02.html"><strong aria-hidden="true">1.2.</strong> Rust å¼€å‘ç¯å¢ƒé…ç½®</a></li><li class="chapter-item expanded "><a href="ch01-03.html"><strong aria-hidden="true">1.3.</strong> Qemu æ¨¡æ‹Ÿå™¨å®‰è£…</a></li><li class="chapter-item expanded "><a href="ch01-04.html"><strong aria-hidden="true">1.4.</strong> å…¶ä»–å·¥å…·å®‰è£…</a></li><li class="chapter-item expanded "><a href="ch01-05.html"><strong aria-hidden="true">1.5.</strong> è¿è¡Œ Hello World</a></li></ol></li><li class="chapter-item expanded "><a href="ch02-00.html"><strong aria-hidden="true">2.</strong> unikernel åŸºæœ¬æ¦‚å¿µ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-01.html"><strong aria-hidden="true">2.1.</strong> ä»€ä¹ˆæ˜¯å•æ ¸ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="ch02-02.html"><strong aria-hidden="true">2.2.</strong> arceos çš„ç»„æˆ</a></li><li class="chapter-item expanded "><a href="ch02-03.html"><strong aria-hidden="true">2.3.</strong> ä¸å…·ä½“ OS æ— å…³çš„ crates</a></li><li class="chapter-item expanded "><a href="ch02-04.html"><strong aria-hidden="true">2.4.</strong> ä¸å…·æœ‰ OS ç›¸å…³çš„ modules</a></li><li class="chapter-item expanded "><a href="ch02-05.html"><strong aria-hidden="true">2.5.</strong> arceos çš„æ¡†æ¶è®¾è®¡</a></li></ol></li><li class="chapter-item expanded "><a href="ch03-00.html"><strong aria-hidden="true">3.</strong> è®¾è®¡å®ç° helloworld unikernel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch03-01.html"><strong aria-hidden="true">3.1.</strong> ä¾é  axhal ç»„ä»¶å®ç°ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡º</a></li><li class="chapter-item expanded "><a href="ch03-02.html"><strong aria-hidden="true">3.2.</strong> helloworld ç¨‹åºåŸºäº axhal ç»„ä»¶å®ç°è¾“å‡º</a></li><li class="chapter-item expanded "><a href="ch03-03.html"><strong aria-hidden="true">3.3.</strong> æ·»åŠ  axruntime ç»„ä»¶æä¾›æ›´å®Œæ•´çš„è¿è¡Œç¯å¢ƒ</a></li><li class="chapter-item expanded "><a href="ch03-04.html"><strong aria-hidden="true">3.4.</strong> ç”±å¼€å¯åŠ¨æ€å†…å­˜åˆ†é…ç‰¹æ€§æ¥åˆè¯†ç³»ç»Ÿç›¸å…³å’Œæ— å…³</a></li><li class="chapter-item expanded "><a href="ch03-05.html"><strong aria-hidden="true">3.5.</strong> ä¿®æ”¹å‘½ä»¤å®ç°å¯¹ features çš„ç»†ç²’åº¦æ§åˆ¶</a></li></ol></li><li class="chapter-item expanded "><a href="ch04-00.html"><strong aria-hidden="true">4.</strong> è®¾è®¡å®ç°åä½œå¼å¤šä»»åŠ¡ unikernel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01.html"><strong aria-hidden="true">4.1.</strong> åä½œå¼å¤šä»»åŠ¡çš„åŠŸèƒ½éœ€æ±‚</a></li><li class="chapter-item expanded "><a href="ch04-02.html"><strong aria-hidden="true">4.2.</strong> åä½œå¼å¤šä»»åŠ¡ç›¸å…³çš„ crates/modules ç»„æˆ</a></li><li class="chapter-item expanded "><a href="ch04-03.html"><strong aria-hidden="true">4.3.</strong> åä½œå¼å¤šä»»åŠ¡çš„æ¡†æ¶è®¾è®¡</a></li><li class="chapter-item expanded "><a href="ch04-04.html"><strong aria-hidden="true">4.4.</strong> ç»„è£…åä½œå¼å¤šä»»åŠ¡ unikernel</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Arceos Tutorial Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rcore-os/arceos-tutorial-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ç®€æ˜-arceos-tutorial-book"><a class="header" href="#ç®€æ˜-arceos-tutorial-book">ç®€æ˜ Arceos Tutorial Book</a></h1>
<h2 id="è‡ªå·±åŠ¨æ‰‹å†™ç»„ä»¶åŒ–æ“ä½œç³»ç»Ÿè‡ªé¡¶å‘ä¸‹è‡ªåº•å‘ä¸Šçš„æ–¹æ³•"><a class="header" href="#è‡ªå·±åŠ¨æ‰‹å†™ç»„ä»¶åŒ–æ“ä½œç³»ç»Ÿè‡ªé¡¶å‘ä¸‹è‡ªåº•å‘ä¸Šçš„æ–¹æ³•">è‡ªå·±åŠ¨æ‰‹å†™ç»„ä»¶åŒ–æ“ä½œç³»ç»Ÿï¼šè‡ªé¡¶å‘ä¸‹+è‡ªåº•å‘ä¸Šçš„æ–¹æ³•</a></h2>
<p>æœ¬æ•™ç¨‹å‡è®¾è¯»è€…äº†è§£æ“ä½œç³»ç»ŸåŸºæœ¬æ¦‚å¿µå’ŒåŸç†ï¼Œå…·æœ‰å¸¸ç”¨çš„ Linux ç³»ç»Ÿä½¿ç”¨ç»éªŒï¼Œå¹¶ä¸”ä¼šä½¿ç”¨ Rust è¯­è¨€ç¼–å†™ç®€å•ç¨‹åºã€‚
å¦‚æœè¯»è€…ä¸ç†Ÿæ‚‰æ“ä½œç³»ç»Ÿå’Œ Rust è¯­è¨€ï¼Œå¸Œæœ›ä»¥è‡ªåº•å‘ä¸Šæ–¹æ³•ä»é›¶æ„å»ºæ“ä½œç³»ç»Ÿï¼Œ[rCore Tutorial Boook v3] å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>å¦‚æœä½ å‡†å¤‡å¥½äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å®éªŒç¯å¢ƒé…ç½®"><a class="header" href="#å®éªŒç¯å¢ƒé…ç½®">å®éªŒç¯å¢ƒé…ç½®</a></h1>
<p>æœ¬ç« æˆ‘ä»¬å°†å®Œæˆç¯å¢ƒé…ç½®å¹¶æˆåŠŸè¿è¡Œ helloworld unikernelã€‚æ•´ä¸ªæµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://cg1937.github.io/arceos-tutorial-book/ch01-01.html">OS ç¯å¢ƒé…ç½®</a></li>
<li><a href="https://cg1937.github.io/arceos-tutorial-book/ch01-02.html">Rust å¼€å‘ç¯å¢ƒé…ç½®</a></li>
<li><a href="https://cg1937.github.io/arceos-tutorial-book/ch01-03.html">QEMU æ¨¡æ‹Ÿå™¨å®‰è£…</a></li>
<li><a href="https://cg1937.github.io/arceos-tutorial-book/ch01-04.html">å…¶ä»–å·¥å…·å®‰è£…</a></li>
<li><a href="https://cg1937.github.io/arceos-tutorial-book/ch01-05.html">è¿è¡Œ helloworld unikernel</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="os-ç¯å¢ƒé…ç½®"><a class="header" href="#os-ç¯å¢ƒé…ç½®">OS ç¯å¢ƒé…ç½®</a></h2>
<p>ç›®å‰å®éªŒå†…å®¹å¯æ”¯æŒåœ¨ <a href="https://cdimage.ubuntu.com/releases/">Ubuntuæ“ä½œç³»ç»Ÿ</a> ä¸Šè¿›è¡Œæ“ä½œã€‚</p>
<p>å¯¹äº Windows10/11 çš„ç”¨æˆ·å¯ä»¥é€šè¿‡ç³»ç»Ÿå†…ç½®çš„ WSL2 è™šæ‹Ÿæœºï¼ˆè¯·ä¸è¦ä½¿ç”¨ WSL1ï¼‰æ¥å®‰è£… Ubuntu 22.04ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>å‡çº§ Windows 10/11 åˆ°æœ€æ–°ç‰ˆï¼ˆWindows 10 ç‰ˆæœ¬ 18917 æˆ–ä»¥åçš„å†…éƒ¨ç‰ˆæœ¬ï¼‰ã€‚æ³¨æ„ï¼Œå¦‚æœä¸æ˜¯ Windows 10/11 ä¸“ä¸šç‰ˆï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼Œåœ¨å¾®è½¯å®˜ç½‘ä¸Šä¸‹è½½ã€‚å‡çº§ä¹‹åï¼Œ å¯ä»¥åœ¨ PowerShell ä¸­è¾“å…¥ <code>winver</code> å‘½ä»¤æ¥æŸ¥çœ‹å†…éƒ¨ç‰ˆæœ¬å·ã€‚</p>
</li>
<li>
<p>ã€ŒWindows è®¾ç½® &gt; æ›´æ–°å’Œå®‰å…¨ &gt; Windows é¢„è§ˆä½“éªŒè®¡åˆ’ã€å¤„é€‰æ‹©åŠ å…¥ â€œDev å¼€å‘è€…æ¨¡å¼â€ã€‚</p>
</li>
<li>
<p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell ç»ˆç«¯å¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-powershell"># å¯ç”¨ Windows åŠŸèƒ½ï¼šâ€œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿâ€
&gt;&gt; dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# å¯ç”¨ Windows åŠŸèƒ½ï¼šâ€œå·²å®‰è£…çš„ç³»ç»Ÿè™šæ‹Ÿæœºå¹³å°â€
&gt;&gt; dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# &lt;Distro&gt; æ”¹ä¸ºå¯¹åº”ä»å¾®è½¯åº”ç”¨å•†åº—å®‰è£…çš„ Linux ç‰ˆæœ¬åï¼Œæ¯”å¦‚ï¼š`wsl --set-version Ubuntu 2`
# å¦‚æœä½ æ²¡æœ‰æå‰ä»å¾®è½¯åº”ç”¨å•†åº—å®‰è£…ä»»ä½• Linux ç‰ˆæœ¬ï¼Œè¯·è·³è¿‡æ­¤æ­¥éª¤
&gt;&gt; wsl --set-version &lt;Distro&gt; 2

# è®¾ç½®é»˜è®¤ä¸º WSL 2ï¼Œå¦‚æœ Windows ç‰ˆæœ¬ä¸å¤Ÿï¼Œè¿™æ¡å‘½ä»¤ä¼šå‡ºé”™
&gt;&gt; wsl --set-default-version 2

# å¯ç”¨è¿è¡Œ WSL å¹¶å®‰è£… Linux çš„ Ubuntu å‘è¡Œç‰ˆæ‰€éœ€çš„åŠŸèƒ½ï¼Œæ ¹æ®å‘å¯¼è®¾ç½®ç”¨æˆ·åå’Œå¯†ç 
&gt;&gt; wsl --install
</code></pre>
</li>
</ul>
<blockquote>
<p><font color=blue><strong>æ³¨è§£ğŸ‘‰</strong></font></p>
<p>ç”±äºæ—¶é—´é—®é¢˜æˆ‘ä»¬ä¸»è¦åœ¨ Ubuntu22.04  on x86-64 ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œåé¢çš„é…ç½®ä¹Ÿæ˜¯åŸºäºæ­¤ç¯å¢ƒè¿›è¡Œã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å…¶ä»– Linux å‘è¡Œç‰ˆä¸Šè¿›è¡Œå®éªŒï¼ŒåŸºæœ¬ä¸Šä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚å¦‚æœé‡åˆ°äº†é—®é¢˜çš„è¯ï¼Œè¯·åœ¨æœ¬èŠ‚çš„è®¨è®ºåŒºä¸­ç•™è¨€ï¼Œæˆ‘ä»¬ä¼šå°½é‡å¸®åŠ©è§£å†³ã€‚</p>
</blockquote>
<p>å‚è€ƒï¼š<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10#step-4---download-the-linux-kernel-update-package">ä½¿ç”¨ WSL åœ¨ Windows ä¸Šå®‰è£… Linux</a></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="rust-å¼€å‘ç¯å¢ƒé…ç½®"><a class="header" href="#rust-å¼€å‘ç¯å¢ƒé…ç½®">Rust å¼€å‘ç¯å¢ƒé…ç½®</a></h2>
<p>é¦–å…ˆå®‰è£… Rust ç‰ˆæœ¬ç®¡ç†å™¨ rustup å’Œ Rust åŒ…ç®¡ç†å™¨ cargoï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨å®˜æ–¹çš„å®‰è£…è„šæœ¬æ¥å®‰è£…ï¼š</p>
<p><code>curl https://sh.rustup.rs -sSf | sh</code></p>
<p>å¦‚æœé€šè¿‡å®˜æ–¹çš„è„šæœ¬ä¸‹è½½å¤±è´¥äº†ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥ <a href="https://sh.rustup.rs/">https://sh.rustup.rs</a> æ¥ä¸‹è½½è„šæœ¬ï¼Œåœ¨æœ¬åœ°è¿è¡Œå³å¯ã€‚</p>
<p>å¦‚æœå®˜æ–¹çš„è„šæœ¬åœ¨è¿è¡Œæ—¶å‡ºç°äº†ç½‘ç»œé€Ÿåº¦è¾ƒæ…¢çš„é—®é¢˜ï¼Œå¯é€‰åœ°å¯ä»¥é€šè¿‡ä¿®æ”¹ rustup çš„é•œåƒåœ°å€ï¼ˆä¿®æ”¹ä¸ºä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦çš„é•œåƒæœåŠ¡å™¨ï¼‰æ¥åŠ é€Ÿï¼š</p>
<pre><code class="language-bash">export RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static
export RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup
curl https://sh.rustup.rs -sSf | sh
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ tuna æºæ¥åŠ é€Ÿ <a href="https://mirrors.tuna.tsinghua.edu.cn/help/rustup/">å‚è§ rustup å¸®åŠ©</a>ï¼š</p>
<pre><code class="language-bash">export RUSTUP_DIST_SERVER=https://mirrors.tuna.edu.cn/rustup
export RUSTUP_UPDATE_ROOT=https://mirrors.tuna.edu.cn/rustup/rustup
curl https://sh.rustup.rs -sSf | sh
</code></pre>
<p>æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è¿è¡Œå‰è®¾ç½®å‘½ä»¤è¡Œä¸­çš„ç§‘å­¦ä¸Šç½‘ä»£ç†æ¥å®ç°ï¼š</p>
<pre><code class="language-bash"># e.g. Shadowsocks ä»£ç†ï¼Œè¯·æ ¹æ®è‡ªèº«é…ç½®çµæ´»è°ƒæ•´ä¸‹é¢çš„é“¾æ¥
export https_proxy=http://127.0.0.1:1080
export http_proxy=http://127.0.0.1:1080
export ftp_proxy=http://127.0.0.1:1080
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ‰“å¼€ä¸€ä¸ªç»ˆç«¯æ¥è®©ä¹‹å‰è®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å°†ç¯å¢ƒå˜é‡è®¾ç½®åº”ç”¨åˆ°å½“å‰ç»ˆç«¯ï¼Œåªéœ€è¦è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p><code>source $HOME/.cargo/env</code></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤ä¸€ä¸‹æˆ‘ä»¬æ­£ç¡®å®‰è£…äº† Rust å·¥å…·é“¾ï¼š</p>
<p><code>rustc --version</code></p>
<p>å¯ä»¥çœ‹åˆ°å½“å‰å®‰è£…çš„å·¥å…·é“¾çš„ç‰ˆæœ¬ã€‚</p>
<p><code>rustc 1.70.0 (90c541806 2023-05-31)</code></p>
<blockquote>
<p><font color=red><strong>è­¦å‘Šâš ï¸</strong></font></p>
<p>ç›®å‰é€‚ç”¨äºæ“ä½œç³»ç»Ÿå®éªŒå¼€å‘çš„ rustc ç¼–è¯‘å™¨çš„ç‰ˆæœ¬ä¸º 1.73.0ï¼Œä½ å¯ä»¥é€‰æ‹©æ›´æ–°ç‰ˆæœ¬çš„ rustc ç¼–è¯‘å™¨ã€‚ä½†æ³¨æ„<strong>åªèƒ½ç”¨ rustc çš„ nightly ç±»å‹çš„ç‰ˆæœ¬</strong>ã€‚</p>
</blockquote>
<p>å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£… rustc çš„ nightly ç‰ˆæœ¬ï¼Œå¹¶æŠŠè¯¥ç‰ˆæœ¬è®¾ç½®ä¸º rustc çš„é»˜è®¤ç‰ˆæœ¬ã€‚</p>
<pre><code class="language-bash">rustup install nightly
rustup default nightly
</code></pre>
<p>å†æ¬¡ç¡®è®¤ä¸€ä¸‹æˆ‘ä»¬å®‰è£…äº†æ­£ç¡®çš„ rustc  ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-bash">sunny@SunnyDream:~$ rustc --version
rustc 1.73.0-nightly (33a2c2487 2023-07-12)
</code></pre>
<p>æˆ‘ä»¬æœ€å¥½æŠŠè½¯ä»¶åŒ…ç®¡ç†å™¨ cargo æ‰€ç”¨çš„è½¯ä»¶åŒ…é•œåƒåœ°å€ crates.io ä¹Ÿæ¢æˆä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦çš„é•œåƒæœåŠ¡å™¨æ¥åŠ é€Ÿä¸‰æ–¹åº“çš„ä¸‹è½½ã€‚æˆ‘ä»¬æ‰“å¼€ï¼ˆå¦‚æœæ²¡æœ‰å°±æ–°å»ºï¼‰ <code>~/.cargo/config</code> æ–‡ä»¶ï¼Œå¹¶æŠŠå†…å®¹ä¿®æ”¹ä¸ºï¼š</p>
<pre><code>[source.crates-io]
registry = &quot;https://github.com/rust-lang/crates.io-index&quot;
replace-with = 'ustc'
[source.ustc]
registry = &quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;
</code></pre>
<p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ tuna æº <a href="https://mirrors.tuna.tsinghua.edu.cn/help/crates.io-index.git/">å‚è§ crates.io å¸®åŠ©</a>ï¼š</p>
<pre><code>[source.crates-io]
replace-with = 'tuna'

[source.tuna]
registry = &quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git&quot;
</code></pre>
<p>æ¥ä¸‹æ¥å®‰è£…ä¸€äº›Rustç›¸å…³çš„è½¯ä»¶åŒ…</p>
<pre><code class="language-bash">rustup target add riscv64gc-unknown-none-elf
rustup component add llvm-tools-preview
rustup component add rust-src
</code></pre>
<blockquote>
<p><font color=red><strong>è­¦å‘Šâš ï¸</strong></font></p>
<p>å¦‚æœä½ æ›´æ¢äº†å¦å¤–ä¸€ä¸ª rustc ç¼–è¯‘å™¨ï¼ˆå¿…é¡»æ˜¯ nightly ç‰ˆçš„ï¼‰ï¼Œ<strong>éœ€è¦é‡æ–°å®‰è£…ä¸Šè¿° rustc æ‰€éœ€è½¯ä»¶åŒ…</strong>ã€‚ArceOS ä»“åº“ä¸­çš„ <code>Makefile</code> åŒ…å«äº†è¿™äº›å·¥å…·çš„å®‰è£…ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>make run</code> ä¹Ÿå¯ä»¥ä¸æ‰‹åŠ¨å®‰è£…ã€‚</p>
</blockquote>
<p>è‡³äº Rust å¼€å‘ç¯å¢ƒï¼Œæ¨è JetBrains Clion + Rustæ’ä»¶ æˆ–è€… Visual Studio Code æ­é… rust-analyzer å’Œ RISC-V Support æ’ä»¶ã€‚</p>
<blockquote>
<p><font color=blue><strong>æ³¨è§£ğŸ‘‰</strong></font></p>
<p>JetBrains Clion ä»˜è´¹å•†ä¸šè½¯ä»¶ï¼Œä½†å¯¹äºå­¦ç”Ÿå’Œæ•™å¸ˆï¼Œåªè¦åœ¨ JetBrains ç½‘ç«™æ³¨å†Œè´¦å·ï¼Œå¯ä»¥äº«å—ä¸€å®šæœŸé™ï¼ˆåŠå¹´å·¦å³ï¼‰çš„å…è´¹ä½¿ç”¨çš„ç¦åˆ©ã€‚</p>
<ul>
<li>Visual Studio Code æ˜¯å¼€æºè½¯ä»¶ï¼Œä¸ç”¨ä»˜è´¹å°±å¯ä½¿ç”¨ã€‚</li>
<li>å½“ç„¶ï¼Œé‡‡ç”¨ VIMï¼ŒEmacs ç­‰ä¼ ç»Ÿçš„ç¼–è¾‘å™¨ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="qemu-æ¨¡æ‹Ÿå™¨å®‰è£…"><a class="header" href="#qemu-æ¨¡æ‹Ÿå™¨å®‰è£…">QEMU æ¨¡æ‹Ÿå™¨å®‰è£…</a></h2>
<p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ QEMU 7.0 ç‰ˆæœ¬è¿›è¡Œå®éªŒï¼Œä½ç‰ˆæœ¬çš„ QEMU å¯èƒ½å¯¼è‡´æ¡†æ¶ä»£ç ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚è€Œå¾ˆå¤š Linux å‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ç®¡ç†å™¨é»˜è®¤è½¯ä»¶æºä¸­çš„ QEMU ç‰ˆæœ¬è¿‡ä½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»æºç æ‰‹åŠ¨ç¼–è¯‘å®‰è£… QEMU æ¨¡æ‹Ÿå™¨è½¯ä»¶ã€‚ä¸‹é¢ä»¥ Ubuntu 22.04 ä¸Šçš„å®‰è£…æµç¨‹ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼š</p>
<p>é¦–å…ˆæˆ‘ä»¬å®‰è£…ä¾èµ–åŒ…ï¼Œè·å– QEMU æºä»£ç å¹¶æ‰‹åŠ¨ç¼–è¯‘ï¼š</p>
<pre><code class="language-bash"># å®‰è£…ç¼–è¯‘æ‰€éœ€çš„ä¾èµ–åŒ…
sudo apt install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev \
              gawk build-essential bison flex texinfo gperf libtool patchutils bc \
              zlib1g-dev libexpat-dev pkg-config  libglib2.0-dev libpixman-1-dev libsdl2-dev \
              git tmux python3 python3-pip ninja-build
# ä¸‹è½½æºç åŒ…
# å¦‚æœä¸‹è½½é€Ÿåº¦è¿‡æ…¢å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç™¾åº¦ç½‘ç›˜é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dykndFzY73nqkPL2QXs32Q
# æå–ç ï¼šjimc
wget https://download.qemu.org/qemu-7.0.0.tar.xz
# è§£å‹
tar xvJf qemu-7.0.0.tar.xz
# ç¼–è¯‘å®‰è£…å¹¶é…ç½® RISC-V æ”¯æŒ
cd qemu-7.0.0
./configure --target-list=riscv64-softmmu,riscv64-linux-user  # å¦‚æœè¦æ”¯æŒå›¾å½¢ç•Œé¢ï¼Œå¯æ·»åŠ  &quot; --enable-sdl&quot; å‚æ•°
make -j$(nproc)
</code></pre>
<blockquote>
<p><font color=blue><strong>æ³¨è§£ğŸ‘‰</strong></font>Â  </p>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„ä¾èµ–åŒ…å¯èƒ½å¹¶ä¸å®Œå…¨ï¼Œæ¯”å¦‚åœ¨ Ubuntu 18.04 ä¸Šï¼š</p>
<ul>
<li>å‡ºç° <code>ERROR: pkg-config binary 'pkg-config' not found</code> æ—¶ï¼Œå¯ä»¥å®‰è£… <code>pkg-config</code> åŒ…ï¼›</li>
<li>å‡ºç° <code>ERROR: glib-2.48 gthread-2.0 is required to compile QEMU</code> æ—¶ï¼Œå¯ä»¥å®‰è£… <code>libglib2.0-dev</code> åŒ…ï¼›</li>
<li>å‡ºç° <code>ERROR: pixman &gt;= 0.21.8 not present</code> æ—¶ï¼Œå¯ä»¥å®‰è£… <code>libpixman-1-dev</code> åŒ…ã€‚</li>
</ul>
</blockquote>
<p>å¦å¤–ä¸€äº› Linux å‘è¡Œç‰ˆç¼–è¯‘ QEMU çš„ä¾èµ–åŒ…å¯ä»¥ä» <a href="https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html#prerequisites">è¿™é‡Œ</a> æ‰¾åˆ°ã€‚</p>
<p>ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨åŒç›®å½•ä¸‹ <code>sudo make install</code> å°† QEMU å®‰è£…åˆ° <code>/usr/local/bin</code> ç›®å½•ä¸‹ï¼Œä½†è¿™æ ·ç»å¸¸ä¼šå¼•èµ·å†²çªã€‚ä¸ªäººæ¥è¯´æ›´ä¹ æƒ¯çš„åšæ³•æ˜¯ï¼Œç¼–è¾‘ <code>~/.bashrc</code> æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ <code>bash</code> ç»ˆç«¯ï¼‰ï¼Œåœ¨æ–‡ä»¶çš„æœ«å°¾åŠ å…¥å‡ è¡Œï¼š</p>
<pre><code class="language-bash"># è¯·æ³¨æ„ï¼Œ/path/toæ˜¯qemu-7.0.0 çš„çˆ¶ç›®å½•ï¼Œåº”è°ƒæ•´ä¸ºå®é™…çš„å®‰è£…ä½ç½®
export PATH=$PATH:/path/to/qemu-7.0.0/build
</code></pre>
<p>éšåå³å¯åœ¨å½“å‰ç»ˆç«¯ <code>source ~/.bashrc</code> æ›´æ–°ç³»ç»Ÿè·¯å¾„ï¼Œæˆ–è€…ç›´æ¥é‡å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç¡®è®¤ QEMU çš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-bash">qemu-system-riscv64 --version
qemu-riscv64 --version
</code></pre>
<blockquote>
<p><font color=red><strong>è­¦å‘Šâš ï¸</strong></font></p>
<p>è¯·å°½é‡ä¸è¦å®‰è£… <code>qemu-kvm</code> ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ¡†æ¶æ— æ³•æ­£å¸¸è¿è¡Œã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä»…åœ¨ Qemu 7.0.0 ç‰ˆæœ¬ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œè¯·å°½é‡ä¸è¦åˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬ã€‚</p>
</blockquote>
<h3 id="q--a"><a class="header" href="#q--a">Q &amp; A</a></h3>
<p>å½“å®‰è£…ç¼–è¯‘æ‰€éœ€çš„ä¾èµ–åŒ…å‡ºç°Package xxx is not available, but is referred to by another package é”™è¯¯æ—¶ï¼Œå¯ä»¥å°è¯•æ›´æ–°ç³»ç»Ÿè½¯ä»¶æºï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get upgrade
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="å…¶ä»–å·¥å…·å®‰è£…"><a class="header" href="#å…¶ä»–å·¥å…·å®‰è£…">å…¶ä»–å·¥å…·å®‰è£…</a></h2>
<p>æœ¬èŠ‚ä¸»è¦ä»‹ç» arceos ç¼–è¯‘æ‰€éœ€çš„ä¾èµ–å·¥å…·çš„å®‰è£…ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨ objdumpã€objcopy å·¥å…·ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®‰è£…åä¸º cargo-binutils çš„å‘½ä»¤è¡Œå·¥å…·é›†ï¼š</p>
<pre><code class="language-bash">cargo install cargo-binutils
</code></pre>
<p>ä¸ºäº†ç¼–è¯‘è¿è¡Œ C åº”ç”¨ç¨‹åºï¼Œå®‰è£… <code>libclang-dev</code>ï¼š</p>
<pre><code class="language-bash">sudo apt install libclang-dev
</code></pre>
<p>ä¸‹è½½å¹¶å®‰è£… <code>cross-musl-based</code>å·¥å…·é“¾ï¼š</p>
<pre><code class="language-bash"># download
wget https://musl.cc/aarch64-linux-musl-cross.tgz
wget https://musl.cc/riscv64-linux-musl-cross.tgz
wget https://musl.cc/x86_64-linux-musl-cross.tgz
# install
tar zxf aarch64-linux-musl-cross.tgz
tar zxf riscv64-linux-musl-cross.tgz
tar zxf x86_64-linux-musl-cross.tgz
# exec below command in bash OR add below info in ~/.bashrc
export PATH=`pwd`/x86_64-linux-musl-cross/bin:`pwd`/aarch64-linux-musl-cross/bin:`pwd`/riscv64-linux-musl-cross/bin:$PATH
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="è¿è¡Œ-helloworld-unikernel"><a class="header" href="#è¿è¡Œ-helloworld-unikernel">è¿è¡Œ helloworld unikernel</a></h2>
<p>æœ¬èŠ‚ä»‹ç»å¦‚ä½•åœ¨ QEMU æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ helloworld unikernelã€‚</p>
<ol>
<li>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè·å– ArceOS æºç åŒ…ï¼š</p>
<p><code>git clone https://github.com/rcore-os/arceos.git</code></p>
</li>
<li>
<p>è¿›å…¥arceosç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç¼–è¯‘å¹¶è¿è¡Œ helloworld unikernelï¼š</p>
<p><code>make ARCH=riscv64 A=apps/helloworld run</code></p>
<p>å…¶ä¸­ï¼Œ</p>
<p>ARCH æŒ‡å®š CPU ä½“ç³»æ¶æ„ï¼Œç›®å‰æ”¯æŒé€‰é¡¹ï¼š<code>riscv64</code>, <code>aarch64</code>ï¼Œ<code>x86_64</code>ã€‚</p>
<p>A æŒ‡å®šç”¨æˆ·ç¨‹åºçš„ç›¸å¯¹è·¯å¾„ã€‚</p>
</li>
</ol>
<p><img src="./img/01_05_01.png" alt="image-20230712163420462" /></p>
<p>åˆ°è¿™é‡Œï¼Œæ­å–œä½ å®Œæˆäº†å®éªŒç¯å¢ƒçš„é…ç½®ï¼Œå¯ä»¥å¼€å§‹é˜…è¯»æ•™ç¨‹çš„æ­£æ–‡éƒ¨åˆ†äº†ï¼</p>
<h3 id="q--a-1"><a class="header" href="#q--a-1">Q &amp; A</a></h3>
<p>å½“ä»£ç è·‘ä¸èµ·æ¥çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ï¼š</p>
<ul>
<li>åˆ†æ”¯æ˜¯å¦ä¸ åŸç‰ˆä»“åº“ï¼ˆè€Œé fork å‡ºæ¥çš„ä»“åº“ï¼‰çš„å¯¹åº”åˆ†æ”¯åŒæ­¥ã€‚å¦‚ä¸åŒæ­¥çš„è¯è€ƒè™‘é€šè¿‡ <code>git pull</code> è¿›è¡Œæ›´æ–°ã€‚æ³¨ï¼šè¿™æ˜¯å› ä¸º Rust çš„ç‰ˆæœ¬æ›´è¿­è¾ƒå¿«ï¼Œå¦‚ä¸åŠæ—¶æ›´æ–°çš„è¯æ›¾ç»èƒ½æ­£å¸¸è¿è¡Œçš„ä»£ç ä¹Ÿä¼šæ— æ³•è¿è¡Œã€‚</li>
<li>é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>rust-toolchain</code> éå¸¸é‡è¦ï¼Œå®ƒä»£è¡¨æ•´ä¸ªé¡¹ç›®é‡‡ç”¨çš„ Rust å·¥å…·é“¾ç‰ˆæœ¬ã€‚è¯·åŠ¡å¿…ä¿æŒå…¶ä¸åŸç‰ˆä»“åº“å¯¹åº”åˆ†æ”¯ä¸€è‡´ã€‚</li>
<li>é€šè¿‡ <code>make clean</code> æˆ–è€… <code>cargo clean</code> åˆ é™¤æ„å»ºäº§ç‰©ï¼Œå¹¶é‡æ–° <code>make run</code> ã€‚æ³¨ï¼šå‡ºç°è¿™æ ·çš„é—®é¢˜é€šå¸¸è¯´æ˜æ¡†æ¶çš„æ„å»ºè„šæœ¬å­˜åœ¨ bugï¼Œå¯ä»¥æ issueã€‚</li>
</ul>
<p>å¦‚æœæ€€ç–‘é‡åˆ°äº†ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥æ£€æŸ¥ï¼š</p>
<ul>
<li>è¯·æŒ‰ç…§æœ¬ç« è¯´æ˜è¿›è¡Œ Rust å®‰è£…å’Œ crates.io é•œåƒé…ç½®ã€‚é€šå¸¸æƒ…å†µä¸‹èƒ½å¤Ÿè§£å†³ Rust å·¥å…·é“¾æ›´æ–°å’Œä¸‹è½½å·²å‘å¸ƒåˆ° crates.io ä¸Šåº“çš„é—®é¢˜ã€‚</li>
</ul>
<!--
- å¦‚æœå‘ç°åœ¨è¯•å›¾ä» github ä¸Šä¸‹è½½ä¸‹è¿°å‡ ä¸ªåº“çš„æ—¶å€™å¡æ­»ï¼Œå¯ä»¥ä¿®æ”¹ `arceos` ç›®å½•ä¸‹çš„ `Cargo.toml` æ›¿æ¢ä¸º gitee ä¸Šçš„é•œåƒã€‚ä¾‹å¦‚ï¼Œå°†ï¼š

  > ```toml
  > riscv = { git = "https://github.com/rcore-os/riscv", features = ["inline-asm"] }
  > ```
  
  æ›¿æ¢ä¸ºï¼š
  
  > ```toml
  > riscv = { git = "https://gitee.com/rcore-os/riscv", features = ["inline-asm"] }
  > ```
--><div style="break-before: page; page-break-before: always;"></div><h2 id="unikernel-åŸºæœ¬æ¦‚å¿µ"><a class="header" href="#unikernel-åŸºæœ¬æ¦‚å¿µ">Unikernel åŸºæœ¬æ¦‚å¿µ</a></h2>
<h3 id="unikernelæ˜¯ä¸€ç§è½»é‡çº§æ“ä½œç³»ç»Ÿæ„å»ºæŠ€æœ¯å®ƒå°†åº”ç”¨ç¨‹åºå†…æ ¸å¿…è¦ç»„ä»¶ç¼–è¯‘æ‰“åŒ…ä¸ºä¸€ä¸ªçš„æœ€å°åŒ–çš„é•œåƒè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨æˆ–è£¸æœº"><a class="header" href="#unikernelæ˜¯ä¸€ç§è½»é‡çº§æ“ä½œç³»ç»Ÿæ„å»ºæŠ€æœ¯å®ƒå°†åº”ç”¨ç¨‹åºå†…æ ¸å¿…è¦ç»„ä»¶ç¼–è¯‘æ‰“åŒ…ä¸ºä¸€ä¸ªçš„æœ€å°åŒ–çš„é•œåƒè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨æˆ–è£¸æœº">Unikernelæ˜¯ä¸€ç§è½»é‡çº§æ“ä½œç³»ç»Ÿæ„å»ºæŠ€æœ¯ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºã€å†…æ ¸ã€å¿…è¦ç»„ä»¶ç¼–è¯‘æ‰“åŒ…ä¸ºä¸€ä¸ªçš„æœ€å°åŒ–çš„é•œåƒï¼Œè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨æˆ–è£¸æœºã€‚</a></h3>
<p>Unikernel æœ‰å¦‚ä¸‹ç‰¹ç‚¹:</p>
<ol>
<li>
<p>å•ä¸€é•œåƒï¼šå°†åº”ç”¨ç¨‹åºä»£ç ä¸æ“ä½œç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½åˆå¹¶åˆ°ä¸€ä¸ªå•ä¸€çš„å¯æ‰§è¡Œé•œåƒä¸­ã€‚è¿™ä¸ªé•œåƒåŒ…å«äº†åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç»œåè®®ã€æ–‡ä»¶ç³»ç»Ÿå’Œè®¾å¤‡é©±åŠ¨ç­‰ã€‚å› æ­¤ï¼Œæ¯ä¸ª Unikernel å®ä¾‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€è‡ªåŒ…å«çš„å•å…ƒã€‚</p>
</li>
<li>
<p>å®šåˆ¶æ€§ï¼šæ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿›è¡Œå®šåˆ¶ï¼ŒåªåŒ…å«å¿…è¦çš„ç»„ä»¶å’Œåº“ã€‚è¿™ç§å®šåˆ¶æ€§å‡å°‘äº†ä¸å¿…è¦çš„åŠŸèƒ½å’Œå¤æ‚æ€§ï¼Œåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸‹æ›´åŠ é«˜æ•ˆã€‚</p>
</li>
<li>
<p>è½»é‡çº§ï¼šç›¸æ¯”ä¼ ç»Ÿæ“ä½œç³»ç»Ÿï¼Œå†…å­˜å ç”¨æ›´å°ï¼Œå¯åŠ¨æ—¶é—´æ›´çŸ­ã€‚ç”±äºåªåŒ…å«å¿…è¦çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°é€‚åº”åµŒå…¥å¼ç³»ç»Ÿã€è™šæ‹ŸåŒ–ç¯å¢ƒå’Œäº‘è®¡ç®—å¹³å°ç­‰èµ„æºå—é™çš„åœºæ™¯ã€‚</p>
</li>
<li>
<p>æ€§èƒ½æ•ˆç‡ï¼šé€šè¿‡å‡å°‘ä¸å¿…è¦çš„è½¯ä»¶å±‚å’Œç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘äº†æ€§èƒ½å¼€é”€ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥æ›´é«˜æ•ˆåœ°è¿è¡Œã€‚</p>
</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼ŒUnikernel æ˜¯ä¸€ç§ç²¾ç®€ã€å®šåˆ¶åŒ–çš„æ“ä½œç³»ç»Ÿæ„å»ºæŠ€æœ¯ï¼Œæ—¨åœ¨æä¾›æ›´é«˜çš„æ€§èƒ½ã€æ›´ä½çš„èµ„æºæ¶ˆè€—å’Œæ›´å¼ºçš„å®‰å…¨æ€§ã€‚å®ƒé€‚ç”¨äºå„ç§åœºæ™¯ï¼ŒåŒ…æ‹¬åµŒå…¥å¼ç³»ç»Ÿã€äº‘è®¡ç®—å¹³å°å’Œå®¹å™¨åŒ–ç¯å¢ƒç­‰ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£Unikernelï¼Œæˆ‘ä»¬å¯¹ Unikernelï¼ˆå•ä¸€å†…æ ¸ï¼‰ã€ Micro Kernelï¼ˆå¾®å†…æ ¸ï¼‰ã€Monolithic Kernelï¼ˆå®å†…æ ¸ï¼‰è¿›è¡Œå¯¹æ¯”ã€‚</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Unikernelï¼ˆå•ä¸€å†…æ ¸ï¼‰</th><th>Micro Kernelï¼ˆå¾®å†…æ ¸ï¼‰</th><th>Monolithic Kernelï¼ˆå®å†…æ ¸ï¼‰</th></tr></thead><tbody>
<tr><td>æ¶æ„</td><td>å°†åº”ç”¨ç¨‹åºã€æ“ä½œç³»ç»Ÿå†…æ ¸ã€å¿…è¦çš„ç»„ä»¶ç´§å¯†é›†æˆåœ¨ä¸€èµ·ï¼Œä»¥åˆ›å»ºä¸€ä¸ªé«˜åº¦å®šåˆ¶åŒ–å’Œæœ€å°åŒ–çš„é•œåƒã€‚</td><td>é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æœ€å°åŒ–ï¼Œé¢å¤–çš„åŠŸèƒ½å’ŒæœåŠ¡å®ç°ä¸ºç”¨æˆ·ç©ºé—´çš„æœåŠ¡æ¨¡å—ã€‚</td><td>å°†å„ç§åŠŸèƒ½å’ŒæœåŠ¡é›†æˆåˆ°ä¸€ä¸ªå•ä½“å†…æ ¸ä¸­ï¼Œå¦‚è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œåè®®æ ˆç­‰ã€‚</td></tr>
<tr><td>åŠŸèƒ½åˆ†é…</td><td>åŒ…å«åº”ç”¨ç¨‹åºæ‰€éœ€çš„æœ€å°åŒ–æ“ä½œç³»ç»ŸåŠŸèƒ½å’Œåº“ã€‚</td><td>åŒ…å«åŸºæœ¬çš„æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œå¦‚è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†å’Œè¿›ç¨‹é—´é€šä¿¡ï¼Œè€Œå…¶ä»–åŠŸèƒ½å¦‚æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œåè®®æ ˆç­‰è¢«å®ç°ä¸ºç”¨æˆ·ç©ºé—´çš„æœåŠ¡æ¨¡å—ã€‚</td><td>åŒ…å«å¤§é‡çš„åŠŸèƒ½å’ŒæœåŠ¡ï¼Œè¿™äº›åŠŸèƒ½å’ŒæœåŠ¡ç›´æ¥è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œå…·æœ‰è¾ƒé«˜çš„é›†æˆæ€§å’Œå†…æ ¸çº§åˆ«çš„è®¿é—®æƒé™ã€‚</td></tr>
<tr><td>æ€§èƒ½</td><td>é•œåƒå°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œæ²¡æœ‰é¢å¤–çš„ç»„ä»¶å’Œç³»ç»Ÿè°ƒç”¨ï¼Œå…·æœ‰æ›´é«˜çš„æ€§èƒ½å’Œè¾ƒä½çš„èµ„æºæ¶ˆè€—ã€‚</td><td>å°†åŠŸèƒ½æ¨¡å—åŒ–å¹¶ç§»è‡³ç”¨æˆ·ç©ºé—´ï¼Œå…¶æ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚æ¨¡å—ä¹‹é—´éœ€è¦è¿›è¡Œæ¶ˆæ¯ä¼ é€’å’Œç³»ç»Ÿè°ƒç”¨ï¼Œä¼šå¼•å…¥é¢å¤–çš„å¼€é”€ã€‚</td><td>å†…æ ¸å’ŒæœåŠ¡çš„ç´§å¯†é›†æˆï¼Œæœ‰è¾ƒé«˜çš„æ€§èƒ½</td></tr>
<tr><td>ç‰¹æƒçº§</td><td>åŒä¸€åœ°å€ç©ºé—´åŒä¸€ç‰¹æƒçº§ã€‚</td><td>åªæœ‰è¿›ç¨‹ç®¡ç†å’Œè¿›ç¨‹é—´é€šä¿¡åœ¨å†…æ ¸æ€</td><td>æ‰€æœ‰ç¡¬ä»¶æ“ä½œåœ¨å†…æ ¸æ€</td></tr>
<tr><td>ä»£è¡¨ç³»ç»Ÿ</td><td>Arceosã€Unikraftã€MirageOSã€IncludeOS</td><td>QNXã€MINIXã€L4å¾®å†…æ ¸ç³»åˆ—</td><td>Linuxã€Windows</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="ä»€ä¹ˆæ˜¯å•æ ¸"><a class="header" href="#ä»€ä¹ˆæ˜¯å•æ ¸">ä»€ä¹ˆæ˜¯å•æ ¸ï¼Ÿ</a></h2>
<h3 id="å•æ ¸single-coreæ˜¯æŒ‡è®¡ç®—æœºå¤„ç†å™¨cpuä¸­åªåŒ…å«ä¸€ä¸ªæ ¸å¿ƒåœ¨å•æ ¸å¤„ç†å™¨ä¸­åªæœ‰ä¸€ä¸ªç‰©ç†å¤„ç†æ ¸å¿ƒç”¨äºæ‰§è¡ŒæŒ‡ä»¤å’Œå¤„ç†æ•°æ®"><a class="header" href="#å•æ ¸single-coreæ˜¯æŒ‡è®¡ç®—æœºå¤„ç†å™¨cpuä¸­åªåŒ…å«ä¸€ä¸ªæ ¸å¿ƒåœ¨å•æ ¸å¤„ç†å™¨ä¸­åªæœ‰ä¸€ä¸ªç‰©ç†å¤„ç†æ ¸å¿ƒç”¨äºæ‰§è¡ŒæŒ‡ä»¤å’Œå¤„ç†æ•°æ®">&quot;å•æ ¸&quot;ï¼ˆSingle Coreï¼‰æ˜¯æŒ‡è®¡ç®—æœºå¤„ç†å™¨ï¼ˆCPUï¼‰ä¸­åªåŒ…å«ä¸€ä¸ªæ ¸å¿ƒã€‚åœ¨å•æ ¸å¤„ç†å™¨ä¸­ï¼Œåªæœ‰ä¸€ä¸ªç‰©ç†å¤„ç†æ ¸å¿ƒç”¨äºæ‰§è¡ŒæŒ‡ä»¤å’Œå¤„ç†æ•°æ®ã€‚</a></h3>
<p>æ¯ä¸ªæ ¸å¿ƒæ˜¯å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªç‹¬ç«‹çš„è®¡ç®—å•å…ƒï¼Œå¯ä»¥æ‰§è¡ŒæŒ‡ä»¤ã€æ“ä½œæ•°æ®å’Œå¤„ç†å„ç§ä»»åŠ¡ã€‚å•æ ¸å¤„ç†å™¨åªèƒ½åœ¨ä¸€ä¸ªæ—¶åˆ»æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤æµï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>åœ¨å•æ ¸å¤„ç†å™¨ä¸­ï¼Œæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºå¿…é¡»é€šè¿‡æ—¶é—´ç‰‡è½®è½¬æˆ–å…¶ä»–è°ƒåº¦ç®—æ³•æ¥å…±äº«æ ¸å¿ƒçš„å¤„ç†æ—¶é—´ã€‚è¿™äº›ç®—æ³•åœ¨ä¸åŒä»»åŠ¡ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œä½¿å¾—æ¯ä¸ªä»»åŠ¡éƒ½èƒ½åœ¨ä¸€æ®µæ—¶é—´å†…è·å¾—å¤„ç†å™¨çš„æ—¶é—´ç‰‡ã€‚</p>
<p>ä¸å•æ ¸å¤„ç†å™¨ç›¸å¯¹çš„æ˜¯å¤šæ ¸å¤„ç†å™¨ï¼ˆMulti-Coreï¼‰ï¼Œå¤šæ ¸å¤„ç†å™¨åŒ…å«ä¸¤ä¸ªæˆ–æ›´å¤šçš„å¤„ç†æ ¸å¿ƒï¼Œèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå¹¶æä¾›æ›´é«˜çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡å•æ ¸å¤„ç†å™¨åªæœ‰ä¸€ä¸ªç‰©ç†æ ¸å¿ƒï¼Œä½†å®ƒä»¬ä»ç„¶å¯ä»¥é€šè¿‡è¶…çº¿ç¨‹ï¼ˆHyper-Threadingï¼‰ç­‰æŠ€æœ¯æ¨¡æ‹Ÿå‡ºå¤šä¸ªé€»è¾‘æ ¸å¿ƒï¼Œä»¥æé«˜å¹¶å‘æ‰§è¡Œçš„æ•ˆç‡ã€‚ä½†è¿™äº›é€»è¾‘æ ¸å¿ƒå¹¶ä¸ç­‰åŒäºç‰©ç†æ ¸å¿ƒï¼Œå…¶æ€§èƒ½å’Œå¹¶è¡Œæ€§èƒ½å¯èƒ½æœ‰æ‰€é™åˆ¶ã€‚</p>
<p>ä¸‹é¢æ˜¯å•æ ¸å¤„ç†å™¨ä¸å¤šæ ¸å¤„ç†å™¨çš„å¯¹æ¯”:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>å•æ ¸å¤„ç†å™¨ï¼ˆSingle Coreï¼‰</th><th>å¤šæ ¸å¤„ç†å™¨ï¼ˆMulti-Coreï¼‰</th></tr></thead><tbody>
<tr><td>æ ¸å¿ƒæ•°é‡</td><td>åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçš„å¤„ç†å™¨</td><td>å…·æœ‰ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªæ ¸å¿ƒçš„å¤„ç†å™¨</td></tr>
<tr><td>æ€§èƒ½</td><td>åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤æµ</td><td>åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæä¾›æ›´é«˜çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›</td></tr>
<tr><td>åº”ç”¨ç¨‹åºæ‰§è¡Œ</td><td>æ‰§è¡Œå¤šä¸ªä»»åŠ¡æ—¶éœ€è¦é€šè¿‡æ—¶é—´ç‰‡è½®è½¬æˆ–å…¶ä»–è°ƒåº¦ç®—æ³•æ¥å…±äº«å¤„ç†æ—¶é—´</td><td>èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œæä¾›æ›´å¥½çš„å“åº”æ—¶é—´å’Œå¹¶è¡Œè®¡ç®—èƒ½åŠ›</td></tr>
<tr><td>èƒ½è€—</td><td>èƒ½è€—é€šå¸¸è¾ƒä½</td><td>èƒ½è€—é€šå¸¸è¾ƒé«˜</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="arceos-çš„ç»„æˆ"><a class="header" href="#arceos-çš„ç»„æˆ">Arceos çš„ç»„æˆ</a></h2>
<p>Arceos æ˜¯ä¸€ä¸ªå¼€æºçš„ã€ç»„ä»¶åŒ–çš„Unikernelã€‚ä»¥ç»„åˆç»„ä»¶åº“çš„æ–¹å¼æ„å»ºç³»ç»Ÿã€‚ä½¿ç”¨Rustå¼€å‘ã€‚</p>
<p>å…·æœ‰ä¸€ä¸‹ç‰¹ç‚¹å’ŒåŠŸèƒ½:</p>
<ul>
<li>æ¶æ„æ”¯æŒ: x86_64, riscv64, aarch64</li>
<li>å¹³å°æ”¯æŒ: QEMU pc-q35 (x86_64), virt (riscv64/aarch64)</li>
<li>å¤šçº¿ç¨‹ Multi-thread</li>
<li>FIFO/RR/CFS scheduler</li>
<li>VirtIO net/blk/gpu drivers</li>
<li>ç½‘ç»œåè®®: TCP/UDP net stack using smoltcp</li>
<li>Synchronization/Mutex</li>
<li>SMP scheduling with single run queue</li>
<li>æ–‡ä»¶ç³»ç»Ÿ File system</li>
</ul>
<h3 id="arceos-ç”±appscratesmodulesç»„æˆ"><a class="header" href="#arceos-ç”±appscratesmodulesç»„æˆ">Arceos ç”±appsã€cratesã€modulesç»„æˆ</a></h3>
<ul>
<li>apps: åº”ç”¨ç¨‹åº</li>
<li>modules: ç»„ä»¶åº“</li>
<li>crates: å‡½æ•°åº“</li>
</ul>
<p>å½“å‰Arceosé¡¹ç›®çš„appsåˆ—è¡¨å¦‚ä¸‹:</p>
<h4 id="applications-rust"><a class="header" href="#applications-rust">Applications (Rust)</a></h4>
<div class="table-wrapper"><table><thead><tr><th>App</th><th>Extra modules</th><th>Enabled features</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="../apps/helloworld/">helloworld</a></td><td></td><td></td><td>A minimal app that just prints a string</td></tr>
<tr><td><a href="../apps/exception/">exception</a></td><td></td><td>paging</td><td>Exception handling test</td></tr>
<tr><td><a href="../apps/memtest/">memtest</a></td><td>axalloc</td><td>alloc, paging</td><td>Dynamic memory allocation test</td></tr>
<tr><td><a href="../apps/display/">display</a></td><td>axalloc, axdisplay</td><td>alloc, paging, display</td><td>Graphic/GUI test</td></tr>
<tr><td><a href="../apps/task/yield/">yield</a></td><td>axalloc, axtask</td><td>alloc, paging, multitask, sched_fifo</td><td>Multi-threaded yielding test</td></tr>
<tr><td><a href="../apps/task/parallel/">parallel</a></td><td>axalloc, axtask</td><td>alloc, paging, multitask, sched_fifo, irq</td><td>Parallel computing test (to test synchronization &amp; mutex)</td></tr>
<tr><td><a href="../apps/task/sleep/">sleep</a></td><td>axalloc, axtask</td><td>alloc, paging, multitask, sched_fifo, irq</td><td>Thread sleeping test</td></tr>
<tr><td><a href="../apps/task/priority/">priority</a></td><td>axalloc, axtask</td><td>alloc, paging, multitask, sched_cfs</td><td>Thread priority test</td></tr>
<tr><td><a href="../apps/fs/shell/">shell</a></td><td>axalloc, axdriver, axfs</td><td>alloc, paging, fs</td><td>A simple shell that responds to filesystem operations</td></tr>
<tr><td><a href="../apps/net/httpclient/">httpclient</a></td><td>axalloc, axdriver, axnet</td><td>alloc, paging, net</td><td>A simple client that sends an HTTP request and then prints the response</td></tr>
<tr><td><a href="../apps/net/echoserver/">echoserver</a></td><td>axalloc, axdriver, axnet, axtask</td><td>alloc, paging, net, multitask</td><td>A multi-threaded TCP server that reverses messages sent by the client</td></tr>
<tr><td><a href="../apps/net/httpserver/">httpserver</a></td><td>axalloc, axdriver, axnet, axtask</td><td>alloc, paging, net, multitask</td><td>A multi-threaded HTTP server that serves a static web page</td></tr>
<tr><td><a href="../apps/net/udpserver/">udpserver</a></td><td>axalloc, axdriver, axnet</td><td>alloc, paging, net</td><td>A simple echo server using UDP protocol</td></tr>
</tbody></table>
</div>
<h4 id="applications-c"><a class="header" href="#applications-c">Applications (C)</a></h4>
<div class="table-wrapper"><table><thead><tr><th>App</th><th>Extra modules</th><th>Enabled features</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="../apps/c/helloworld/">helloworld</a></td><td></td><td></td><td>A minimal C app that just prints a string</td></tr>
<tr><td><a href="../apps/c/memtest/">memtest</a></td><td>axalloc</td><td>alloc, paging</td><td>Dynamic memory allocation test in C</td></tr>
<tr><td><a href="../apps/c/sqlite3/">sqlite3</a></td><td>axalloc, axdriver, axfs</td><td>alloc, paging, fp_simd, fs</td><td>Porting of <a href="https://sqlite.org/index.html">SQLite3</a></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="ä¸å…·ä½“-os-æ— å…³çš„-crates"><a class="header" href="#ä¸å…·ä½“-os-æ— å…³çš„-crates">ä¸å…·ä½“ OS æ— å…³çš„ crates</a></h2>
<h3 id="crates-åˆ—è¡¨"><a class="header" href="#crates-åˆ—è¡¨">Crates åˆ—è¡¨</a></h3>
<ul>
<li><a href="../crates/allocator">allocator</a>: Various allocator algorithms in a unified interface.</li>
<li><a href="../crates/arm_gic">arm_gic</a>: ARM Generic Interrupt Controller (GIC) register definitions and basic operations.</li>
<li><a href="../crates/axerrno">axerrno</a>: Error code definition used by ArceOS.</li>
<li><a href="../crates/axfs_devfs">axfs_devfs</a>: Device filesystem used by ArceOS.</li>
<li><a href="../crates/axfs_vfs">axfs_vfs</a>: Virtual filesystem interfaces used by ArceOS.</li>
<li><a href="../crates/axio">axio</a>: <code>std::io</code>-like I/O traits for <code>no_std</code> environment.</li>
<li><a href="../crates/capability">capability</a>: Provide basic capability-based security.</li>
<li><a href="../crates/crate_interface">crate_interface</a>: Provides a way to define an interface (trait) in a crate, but can implement or use it in any crate. <a href="https://crates.io/crates/crate_interface"><img src="https://img.shields.io/crates/v/crate_interface" alt="Crates.io" /></a></li>
<li><a href="../crates/driver_block">driver_block</a>: Common traits and types for block storage drivers.</li>
<li><a href="../crates/driver_common">driver_common</a>: Device driver interfaces used by ArceOS.</li>
<li><a href="../crates/driver_display">driver_display</a>: Common traits and types for graphics device drivers.</li>
<li><a href="../crates/driver_net">driver_net</a>: Common traits and types for network device (NIC) drivers.</li>
<li><a href="../crates/driver_pci">driver_pci</a>: Structures and functions for PCI bus operations.</li>
<li><a href="../crates/driver_virtio">driver_virtio</a>: Wrappers of some devices in the <code>virtio-drivers</code> crate, that implement traits in the <code>driver_common</code> series crates.</li>
<li><a href="../../crates/flatten_objects">flatten_objects</a>: A container that stores numbered objects. Each object can be assigned with a unique ID.</li>
<li><a href="../crates/handler_table">handler_table</a>: A lock-free table of event handlers. <a href="https://crates.io/crates/handler_table"><img src="https://img.shields.io/crates/v/handler_table" alt="Crates.io" /></a></li>
<li><a href="../crates/kernel_guard">kernel_guard</a>: RAII wrappers to create a critical section with local IRQs or preemption disabled. <a href="https://crates.io/crates/kernel_guard"><img src="https://img.shields.io/crates/v/kernel_guard" alt="Crates.io" /></a></li>
<li><a href="../crates/lazy_init">lazy_init</a>: A wrapper for lazy initialized values without concurrency safety but more efficient.</li>
<li><a href="../crates/linked_list">linked_list</a>: Linked lists that supports arbitrary removal in constant time.</li>
<li><a href="../crates/memory_addr">memory_addr</a>: Wrappers and helper functions for physical and virtual addresses. <a href="https://crates.io/crates/memory_addr"><img src="https://img.shields.io/crates/v/memory_addr" alt="Crates.io" /></a></li>
<li><a href="../crates/page_table">page_table</a>: Generic page table structures for various hardware architectures.</li>
<li><a href="../crates/page_table_entry">page_table_entry</a>: Page table entry definition for various hardware architectures.</li>
<li><a href="../crates/percpu">percpu</a>: Define and access per-CPU data structures.</li>
<li><a href="../crates/percpu_macros">percpu_macros</a>: Macros to define and access a per-CPU data structure.</li>
<li><a href="../crates/ratio">ratio</a>: The type of ratios and related operations.</li>
<li><a href="../crates/scheduler">scheduler</a>: Various scheduler algorithms in a unified interface.</li>
<li><a href="../crates/slab_allocator">slab_allocator</a>: Slab allocator for <code>no_std</code> systems. Uses multiple slabs with blocks of different sizes and a linked list for blocks larger than 4096 bytes.</li>
<li><a href="../crates/spinlock">spinlock</a>: <code>no_std</code> spin lock implementation that can disable kernel local IRQs or preemption while locking.</li>
<li><a href="../crates/timer_list">timer_list</a>: A list of timed events that will be triggered sequentially when the timer expires.</li>
<li><a href="../crates/tuple_for_each">tuple_for_each</a>: Provides macros and methods to iterate over the fields of a tuple struct.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ä¸å…·æœ‰-os-ç›¸å…³çš„-modules"><a class="header" href="#ä¸å…·æœ‰-os-ç›¸å…³çš„-modules">ä¸å…·æœ‰ OS ç›¸å…³çš„ modules</a></h2>
<h3 id="modules--åˆ—è¡¨"><a class="header" href="#modules--åˆ—è¡¨">Modules  åˆ—è¡¨</a></h3>
<ul>
<li><a href="../modules/axalloc">axalloc</a>: ArceOS global memory allocator.</li>
<li><a href="../modules/axconfig">axconfig</a>: Platform-specific constants and parameters for ArceOS.</li>
<li><a href="../modules/axdisplay">axdisplay</a>: ArceOS graphics module.</li>
<li><a href="../modules/axdriver">axdriver</a>: ArceOS device drivers.</li>
<li><a href="../modules/axfs">axfs</a>: ArceOS filesystem module.</li>
<li><a href="../modules/axhal">axhal</a>: ArceOS hardware abstraction layer, provides unified APIs for platform-specific operations.</li>
<li><a href="../modules/axlog">axlog</a>: Macros for multi-level formatted logging used by ArceOS.</li>
<li><a href="../modules/axnet">axnet</a>: ArceOS network module.</li>
<li><a href="../modules/axruntime">axruntime</a>: Runtime library of ArceOS.</li>
<li><a href="../modules/axsync">axsync</a>: ArceOS synchronization primitives.</li>
<li><a href="../modules/axtask">axtask</a>: ArceOS task management module.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="arceos-çš„æ¡†æ¶è®¾è®¡"><a class="header" href="#arceos-çš„æ¡†æ¶è®¾è®¡">arceos çš„æ¡†æ¶è®¾è®¡</a></h2>
<img src="./assets/ArceOS.svg" />
<div style="break-before: page; page-break-before: always;"></div><h2 id="è®¾è®¡å®ç°-helloworld-unikernel"><a class="header" href="#è®¾è®¡å®ç°-helloworld-unikernel">è®¾è®¡å®ç° helloworld unikernel</a></h2>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€æ—¶ï¼Œæ¥è§¦çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ç¨‹åºå°±æ˜¯ helloworldï¼Œå½“ä¸€åæ–°çš„ç¨‹åºå‘˜æ¸…é™¤å®Œä¸€åˆ‡éšœç¢é¡ºåˆ©æŠµè¾¾ helloworld æ—¶ï¼Œä»–çš„å†…å¿ƒä½“éªŒåˆ°çš„ä¸ä»…ä»…æ˜¯ä¸€ç§æˆåŠŸçš„å–œæ‚¦ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä»–æ­£åœ¨äº²èº«ç»å†ä¸€ä¸ªè·¨è¶Šå†å²çš„æ—¶åˆ»ã€‚å„ä½ï¼Œä½ è¿˜è®°å¾—ä½ ç¬¬ä¸€æ¬¡å†™çš„ helloworld å—ï¼Ÿ</p>
<p>è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ²¿è¢­å‰äººä¹‹è·¯ï¼Œä»¥ helloworld æ¥å¼€å¯æ²Ÿé€š ArceOS ä¸–ç•Œçš„å†ç¨‹ã€‚æˆ‘ä»¬å°†é€šè¿‡ä»é›¶å¼€å§‹è®¾è®¡å®ç°ä¸€ä¸ª helloworld unikernelï¼Œæ¥ç›´æ¥æ„Ÿå— ArceOS çš„ç†å¿µã€ç‰¹æ€§ã€‚</p>
<h3 id="1-å›é¡¾-arceos"><a class="header" href="#1-å›é¡¾-arceos">1 å›é¡¾ ArceOS</a></h3>
<p>ArceOS æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ï¼ŒåŸºäº unikernel çš„ç»„ä»¶åŒ–æ“ä½œç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>ç»„ä»¶åŒ–ï¼šä»¥ç»„ä»¶ç²’åº¦ç»„è£…é€‚åº”å„ç§åº”ç”¨éœ€æ±‚çš„æ“ä½œç³»ç»Ÿã€‚</li>
<li>ä»¥åº”ç”¨ä¸ºä¸­å¿ƒ(unikernel)ï¼šé¢å‘åº”ç”¨ï¼Œä¾ç…§ä¾èµ–é“¾ï¼Œé€‰å‡ºæœ€å°çš„å¿…è¦ç»„ä»¶é›†åˆï¼Œæ„é€ æ“ä½œç³»ç»Ÿã€‚</li>
<li>ç»„ä»¶åŒºåˆ†ç³»ç»Ÿç›¸å…³å’Œç³»ç»Ÿæ— å…³ï¼šè¯†åˆ«å…·æœ‰é€šç”¨åŠŸèƒ½çš„ç»„ä»¶ï¼Œå¯ä»¥ä¸ºå…¶å®ƒæ“ä½œç³»ç»Ÿæ‰€å¤ç”¨ã€‚</li>
<li>åˆ©ç”¨ Rust æœºåˆ¶ï¼šä»¥ crate å¯¹åº”ç»„ä»¶ï¼Œtrait å¯¹åº”æ¥å£ï¼Œdependencies+features çš„æ–¹å¼å¯¹ç»„ä»¶è¿›è¡Œç»„ç»‡ã€‚</li>
</ol>
<h3 id="2--helloworld-unikernel-åŠŸèƒ½éœ€æ±‚åˆ†æ"><a class="header" href="#2--helloworld-unikernel-åŠŸèƒ½éœ€æ±‚åˆ†æ">2  helloworld unikernel åŠŸèƒ½éœ€æ±‚åˆ†æ</a></h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹å³å°†å®ç°çš„ helloworld unikernel åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸æˆ‘ä»¬å¾€å¸¸å­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„ helloworld ç¤ºä¾‹ç¨‹åºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int main()
{
	printf(&quot;hello world!&quot;);
    return 0;
}
</code></pre>
<p><strong>ä»¥è¿™ä¸ª C è¯­è¨€ç¼–å†™çš„ helloworld ç¨‹åºä¸ºä¾‹ï¼Œå¯ä»¥å‘ç°</strong>ï¼Œæ— è®ºæ˜¯è¿™ä¸ª helloworld ç¤ºä¾‹ç¨‹åºï¼Œè¿˜æ˜¯ç°åœ¨çš„ helloworld unikernelï¼Œæ ¸å¿ƒåŠŸèƒ½éƒ½æ˜¯å‘å±å¹•æ‰“å° â€hello worldâ€œ å­—ç¬¦ä¸²ã€‚</p>
<p>ä¸åŒçš„æ˜¯ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆä¸è€ƒè™‘åµŒå…¥å¼ç³»ç»Ÿï¼‰ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•æŠŠcè¯­è¨€ç¨‹åºç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç¨‹åºç›´æ¥æ”¾åœ¨ä¸€ä¸ªè£¸æœºç¯å¢ƒä¸Šæ˜¯ä¸èƒ½å¤Ÿè¿è¡Œçš„ï¼Œå› ä¸ºç¼ºå°‘å®ƒä¾èµ–çš„å„ç§æœåŠ¡å’Œèµ„æºï¼Œç¼ºä¹å’Œç¡¬ä»¶äº¤äº’çš„èƒ½åŠ›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦åœ¨ä¸€å°è£¸æœºä¸Šéƒ¨ç½²è¿™ä¸ªåº”ç”¨ï¼Œè‡³å°‘éœ€è¦å®‰è£…ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œç„¶åæ‰èƒ½ä»¤è¿™ä¸ª helloworld æˆåŠŸè¿è¡Œã€‚</p>
<p>è€Œå¯¹äº helloworld unikernel æ¥è®²ï¼Œå®ƒæ˜¯ä¸€ä¸ª helloworld åº”ç”¨+æœ€å°æ”¯æ’‘è¿è¡Œç¯å¢ƒçš„é›†åˆï¼Œåœ¨ä¸€å°è£¸æœºä¸Šè¿›è¡Œçƒ§å½•ï¼Œå°±å¯ä»¥æ‰§è¡Œ helloworld ç¨‹åºã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œhelloworld unikernel æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¿è¡Œ helloworld ç¨‹åºçš„ unikernel imageã€‚å†è¿›ä¸€æ­¥ï¼Œç»“åˆ unikernel çš„å®šä¹‰æ¥è®²ï¼Œhelloworld unikernel æ˜¯é€šè¿‡æ‰“åŒ…å¿…è¦çš„ ArceOS ç»„ä»¶ï¼Œä¸“é—¨ç”¨æ¥æ”¯æ’‘ helloworld ç¨‹åºè¿è¡Œçš„å•åœ°å€ç©ºé—´æœºå™¨é•œåƒã€‚å…·å¤‡å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œä½œä¸º unikernelï¼Œæˆ–ç§°ä¸º libOSï¼Œèƒ½å¤Ÿå¼•å¯¼æœ¬ç³»ç»Ÿè¿è¡Œï¼ˆåœ¨è£¸æœºä¸Šæ­å»º helloworld åº”ç”¨æ‰€éœ€çš„å¿…è¦è¿è¡Œç¯å¢ƒï¼‰ï¼›</li>
<li>å…¶æ¬¡ï¼Œå…·å¤‡ helloworld çš„åŸºæœ¬åŠŸèƒ½ï¼Œèƒ½å¤Ÿè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯åˆ°å±å¹•ï¼š</li>
</ol>
<p><code>Hello, worldï¼I am arceOSï¼</code></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç»“åˆ ArceOS çš„ç‰¹æ€§ï¼Œä»ç®€å•åˆ°å¤æ‚ï¼Œå°† helloworld unikernel åŠŸèƒ½é€æ­¥åˆ†è§£ï¼Œä»å•ä¸ªç»„ä»¶åˆ°ä¸‰ä¸ªç»„ä»¶ï¼Œç„¶åå¼•å…¥åˆ†å±‚å’Œ feature çš„æ¦‚å¿µï¼Œæœ€ç»ˆå‘ç”¨æˆ·å‘ˆç°ä¸€ä¸ªç®€æ´ã€è§„èŒƒçš„å®ç°è¿‡ç¨‹ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ä¾é -axhal-ç»„ä»¶å®ç°ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡º"><a class="header" href="#ä¾é -axhal-ç»„ä»¶å®ç°ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡º">ä¾é  axhal ç»„ä»¶å®ç°ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡º</a></h2>
<p>åœ¨è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°è¯•å•çº¯å€ŸåŠ© axhal ç»„ä»¶å®ç° helloworld unikernel ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡ºå­—ç¬¦çš„åŠŸèƒ½ï¼Œä¸ºæ­¤éœ€è¦å¯¹é»˜è®¤çš„ axhal ä»£ç åšä¸€ç‚¹ä¿®æ”¹ã€‚</p>
<h3 id="åˆæ¢-axhal-ç»„ä»¶"><a class="header" href="#åˆæ¢-axhal-ç»„ä»¶">åˆæ¢ axhal ç»„ä»¶</a></h3>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¾“å‡ºéƒ½æ˜¯é€šè¿‡ç¡¬ä»¶å®Œæˆçš„ï¼Œæ­£å¦‚ä½ ç°åœ¨æ­£åœ¨çœ‹çš„è¿™ä»½æ–‡æ¡£ï¼Œå®ƒèƒ½æ˜¾ç¤ºåœ¨å±å¹•ä¸Šéƒ½å¾—ç›Šäºæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿä¸ºæˆ‘ä»¬å°è£…å¥½äº†ç¡¬ä»¶æ“ä½œå¹¶èƒ½å¤Ÿæ‰§è¡Œå®ƒã€‚ä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ä¸æ­£æ˜¯å†™ä¸€ä¸ªæ“ä½œç³»ç»Ÿå—ï¼Œæ‰€ä»¥å¾ˆé—æ†¾æˆ‘ä»¬åªèƒ½è‡ªå·±æ·»åŠ ä¸Šä¸ç¡¬ä»¶ç›¸å…³çš„å±‚çš„å°è£…äº†ï¼Œaxhal åº”è¿è€Œç”Ÿã€‚</p>
<pre class="mermaid">graph TD
axhal
</pre>
<p>åœ¨ ArceOS ä¸­ï¼Œaxhal ç»„ä»¶æä¾›äº†ä¸€å±‚é’ˆå¯¹ä¸åŒç¡¬ä»¶å¹³å°çš„ç¡¬ä»¶å°è£…ï¼Œå®ƒä¸ºæŒ‡å®šçš„æ“ä½œå¹³å°è¿›è¡Œå¼•å¯¼å’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶æä¾›å¯¹ç¡¬ä»¶çš„æ“ä½œã€‚ä¾‹å¦‚ modules/axhal/src/platform/qemu_virt_riscv/console.rs é‡Œé¢æä¾›äº†å¯¹å­—ç¬¦è¾“å‡ºçš„å°è£…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨å…¶ä¸­çš„ putchar å‡½æ•°è¿›è¡Œå­—ç¬¦çš„è¾“å‡ºï¼Œè€Œä¸æ˜¯ä¸€æ¬¡åˆä¸€æ¬¡åœ°ä½¿ç”¨ sbi è¿™æ ·æ±‡ç¼–çº§åˆ«çš„ä»£ç è¿›è¡Œè¾“å‡ºã€‚</p>
<p>å…¶å®åœ¨ ArceOS é‡Œé¢ï¼Œputcharå‡½æ•°ç»è¿‡äº†è®¸å¤šå±‚çš„å°è£…å·²ç»å˜æˆç±»ä¼¼äº print è¿™æ ·æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨çš„å‡½æ•°äº†ï¼Œhelloworld unikernel é‡Œé¢çš„è¾“å‡ºè°ƒç”¨é“¾å¯ä»¥æŸ¥çœ‹æœ¬ç« ç¬¬ä¸‰éƒ¨åˆ†ï¼Œ ä½†å…¶å® helloworld è¾“å‡ºçš„æœ¬è´¨è¿˜æ˜¯è°ƒç”¨ axhal ç»„ä»¶çš„putcharå‡½æ•°ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æŠ›æ‰æ–¹ä¾¿ç”¨æˆ·è°ƒç”¨çš„å°è£…ï¼Œé€šè¿‡å¯¹ axhal ä»£ç çš„ä¸€äº›ä¿®æ”¹ï¼Œæ¥ç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹ç³»ç»Ÿå¯åŠ¨å’Œè°ƒç”¨ axhal æ‰€æä¾›çš„ putchar å‡½æ•°è¿›è¡Œè¾“å‡ºçš„æµç¨‹ã€‚</p>
<h3 id="åŠ¨æ‰‹å°è¯•"><a class="header" href="#åŠ¨æ‰‹å°è¯•">åŠ¨æ‰‹å°è¯•</a></h3>
<p>ä»¥ qemu_virt_riscv å¹³å°ä¸ºä¾‹ï¼Œ æˆ‘ä»¬é¦–å…ˆå…³æ³¨ modules/axhal/src/platform/qemu_virt_riscv/boot.rs è¿™ä¸ªæ–‡ä»¶ï¼Œ å…¶ä¸­çš„ _start() å‡½æ•°è¢«é“¾æ¥åˆ° &quot;.text.boot&quot; æ®µï¼Œ ä½œä¸º ArceOS è¿è¡Œçš„ç¬¬ä¸€æ®µä»£ç ã€‚å…·ä½“çš„ä¸åŒæ®µçš„åˆ†é…å¯ä»¥æŸ¥çœ‹ modules/axhal/linker.lds.S æ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•åœ¨é‡Œé¢ç›´æ¥è°ƒç”¨ ArceOS ä¸ºæˆ‘ä»¬å°è£…å¥½çš„ sbi å‡½æ•°è¿›è¡Œè¾“å‡ºï¼Œé¦–å…ˆæ·»åŠ  console_putchar å‡½æ•°æ–¹ä¾¿è¾“å‡ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„ç»“æœã€‚</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe fn console_putchar() {
  putchar(10); // æ‰“å°æ¢è¡Œç¬¦
  putchar(72); // æ‰“å°&quot;Hâ€œ
  putchar(69); // æ‰“å°&quot;Eâ€œ
  putchar(76); // æ‰“å°&quot;Lâ€œ
  putchar(76); // æ‰“å°&quot;Lâ€œ
  putchar(79); // æ‰“å°&quot;Oâ€œ
  // ä¸‹é¢å¯ä»¥è¾“å‡ºä»»ä½•æƒ³è¦çš„å†…å®¹ï¼Œ åªéœ€æ›´æ”¹å‚æ•°å³å¯
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­åŠ å…¥å¯¹ console_putchar å‡½æ•°çš„è°ƒç”¨ï¼Œ æˆ‘ä»¬éœ€è¦åœ¨åˆå§‹åŒ–é¡µè¡¨ä¹‹åï¼Œ åˆå§‹åŒ– mmu ä¹‹å‰æ‰§è¡Œ console_putchar å‡½æ•°ã€‚ å¹¶ä¸”æ·»åŠ </p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>console_putchar = sym console_putchar,
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸€è¡Œï¼Œ ä»¥ä¾¿æ±‡ç¼–ä»£ç è°ƒç”¨æˆ‘ä»¬å†™çš„console_putcharå‡½æ•°</p>
<p>ç„¶åæˆ‘ä»¬åœ¨åˆå§‹åŒ–é¡µè¡¨ä¹‹åå’Œåˆå§‹åŒ–mmuä¹‹å‰è°ƒç”¨è¾“å‡ºï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>call {init_boot_page_table}
call {console_putchar}
call {init_mmu}
<span class="boring">}</span></code></pre></pre>
<p>//  TODO!  å®Œæ•´çš„ä»£ç  (boot.rs) è§å®éªŒéƒ¨åˆ†</p>
<p>æ­¤æ—¶æˆ‘ä»¬åªéœ€æ‰§è¡Œ: </p>
<pre><code class="language-shell">make ARCH=riscv64 A=apps/helloworld run
</code></pre>
<p>å¦‚æ— æ„å¤–ï¼Œ æˆ‘ä»¬åœ¨æ‰“å° ArceOS çš„ LOGO ä¹‹å‰çœ‹åˆ°äº†æˆ‘ä»¬è°ƒç”¨ putchar å‡½æ•°è¿›è¡Œçš„è¾“å‡º &quot;HELLO FROM SBI&quot;ï¼Œ å½“ç„¶ï¼Œæ¯ä¸ªå­—ç¬¦çš„è¾“å‡ºåªéœ€è¦åœ¨ console_putchar ä¸­è‡ªè¡Œæ·»åŠ å³å¯ã€‚ </p>
<p><img src="https://s2.loli.net/2023/07/06/OKws6HjEV478J5D.png" alt="image-20230706161125604" /></p>
<h3 id="æ€»ç»“"><a class="header" href="#æ€»ç»“">æ€»ç»“</a></h3>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä»ç³»ç»Ÿå¼•å¯¼åˆ°è¾“å‡ºçš„æœ€å°æµç¨‹ï¼Œ è€Œä¸”ä»å¼€æœºåˆ°è¾“å‡ºè¿™ä¸ªè¿‡ç¨‹ä¸ä¾èµ–äº axhal å¤–çš„ä»»ä¸€ç»„ä»¶ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥åœ¨çœŸå®çš„ç¡¬ä»¶ç¯å¢ƒä¸­(ä¾‹å¦‚ CV1811H çš„ riscv å¼€å‘æ¿)è¿›è¡Œè¾“å‡ºçš„ï¼Œ è¿™ä¹Ÿä½“ç°äº† ArceOS çš„è®¾è®¡æ€è·¯ï¼Œ æˆ‘ä»¬åªéœ€è¦å¤ç”¨è¿™ä¸€ä¸ªæ¨¡å—ï¼Œå°±èƒ½å¾ˆæ–¹ä¾¿åœ°å¯¹ç¡¬ä»¶è¿›è¡Œæ“ä½œäº†ã€‚ </p>
<h3 id="é™„å½•"><a class="header" href="#é™„å½•">é™„å½•</a></h3>
<h4 id="axhal-æ¨¡å—ç®€ä»‹"><a class="header" href="#axhal-æ¨¡å—ç®€ä»‹"><code>axhal</code> æ¨¡å—ç®€ä»‹ï¼š</a></h4>
<p>æ¨¡å—æºç ä½ç½®ï¼š<a href="https://github.com/rcore-os/arceos/tree/main/modules/axhal">modules/axhal</a></p>
<p>åŠŸèƒ½æè¿°ï¼š ArceOSçš„ç¡¬ä»¶æŠ½è±¡å±‚ï¼Œè´Ÿè´£ä¸ºä¸åŒæ“ä½œå¹³å°æä¾›ç»Ÿä¸€çš„APIã€‚å®ƒä¸ºæŒ‡å®šçš„æ“ä½œå¹³å°è¿›è¡Œå¼•å¯¼å’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶åœ¨ç¡¬ä»¶ä¸Šæä¾›æœ‰ç”¨çš„æ“ä½œã€‚å½“å‰ä¸»è¦æ”¯æŒpc-x86<code>ã€</code>qemu-virt-riscv<code>ã€</code>qemu-virt-aarch64`ç­‰å¹³å°ã€‚</p>
<h4 id="å…³äºè¿™éƒ¨åˆ†çš„ä¸€äº›æ€è·¯æ¥æºå’ŒèƒŒæ™¯è¡¥å……"><a class="header" href="#å…³äºè¿™éƒ¨åˆ†çš„ä¸€äº›æ€è·¯æ¥æºå’ŒèƒŒæ™¯è¡¥å……">å…³äºè¿™éƒ¨åˆ†çš„ä¸€äº›æ€è·¯æ¥æºå’ŒèƒŒæ™¯è¡¥å……ï¼š</a></h4>
<p>å½“æˆ‘ä»¬å°è¯•åœ¨ CV1811H å¼€å‘æ¿ä¸Šç§»æ¤ArceOSæ—¶ï¼Œæˆ‘ä»¬å‘ç° uboot å¼•å¯¼ååœ¨å¼€å‘æ¿ä¸Šæ²¡æœ‰ä»»ä½•çš„è¾“å‡ºï¼Œè€Œæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯æŠ›å¼ƒæ‰ä¸Šå±‚çš„å¤æ‚çš„è¾“å‡ºå°è£…ï¼Œä½¿ç”¨æœ€åŸå§‹çš„ sbi_call å‡½æ•°ï¼ˆå½“æ—¶ä¹Ÿæ²¡æœ‰ä½¿ç”¨ArceOSåŒ…è£…å¥½çš„putcharå‡½æ•°ï¼‰åœ¨axhal ä¸­è¿›è¡Œè¾“å‡ºã€‚ä¾é è¿™ä¸ªæœ€ç®€å•çš„è¾“å‡ºï¼Œæˆ‘ä»¬åˆæ­¥åœ°ç§»æ¤äº†ArceOSåˆ° CV1811H å¼€å‘æ¿ä¸Šã€‚å®é™…ä¸Šï¼Œä»å¼•å¯¼éƒ¨åˆ†çš„ä»£ç ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œaxhal æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç»„ä»¶ï¼Œå®ƒå°±åƒä¸€ä¸ªå°è£…å¥½çš„åº“ä¾›ä¸Šå±‚è°ƒç”¨ï¼Œè¿™ä¹Ÿæ„å‘³ç€å•ç‹¬ä¸ºå…¶å¼€ä¸€èŠ‚æ•™ç¨‹ä¸è¶³ä»¥å±•ç¤ºå®ƒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬æ‰€å¸Œæœ›çš„æ˜¯é€šè¿‡è¾“å‡ºè¿™ä¸€å°åŠŸèƒ½ï¼Œè®©å¤§å®¶æ„ŸçŸ¥åˆ°è¿™ä¸ªæœ€åº•å±‚çš„ axhal æ¨¡å—ã€‚</p>
<p><a href="https://github.com/orgs/rcore-os/discussions/24">å…³äºåœ¨CV1811Hç§»æ¤ArceOSçš„å·¥ä½œ</a></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="helloworld-ç¨‹åºåŸºäº-axhal-ç»„ä»¶å®ç°è¾“å‡º"><a class="header" href="#helloworld-ç¨‹åºåŸºäº-axhal-ç»„ä»¶å®ç°è¾“å‡º">helloworld ç¨‹åºåŸºäº axhal ç»„ä»¶å®ç°è¾“å‡º</a></h2>
<p>æŒ‰ç…§ä¸Šä¸€éƒ¨åˆ†ï¼Œæ—¢ç„¶ axhal ç»„ä»¶å·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº† putchar è¾“å‡ºå‡½æ•°ï¼Œå…¶å®æˆ‘ä»¬å·²ç»å¯ä»¥ç¼–å†™ helloworld ç¨‹åºè¿›è¡Œè¾“å‡ºäº†ï¼Œå¦‚æœå…³æ³¨äº†ç¬¬ä¸‰éƒ¨åˆ†ä¸­ helloworld è¿è¡Œçš„å®Œæ•´æµç¨‹å›¾å°±å¯ä»¥å‘ç° helloworld çš„è¿è¡Œè¿˜ä¾èµ–äº libaxï¼Œlibax å°±æ˜¯æä¾›ä¸€å±‚ç±»ä¼¼äºåº“å‡½æ•°çš„å°è£…ï¼Œå®ƒå®ç°è¾“å‡ºçš„æœ¬è´¨è¿˜æ˜¯ç”¨åˆ°æˆ‘ä»¬æåˆ°çš„ axhal ä¸­çš„è¾“å‡ºï¼Œæˆ‘ä»¬åœ¨æ­¤éƒ¨åˆ†æ›´å¤šè€ƒè™‘åœ°æ˜¯ helloworld ä¸ axhal ç»„ä»¶è¿›è¡Œæ­é…å¹¶ä¸”è¾“å‡ºçš„è¿‡ç¨‹ï¼Œlibax å¯ä»¥çœ‹æˆæ˜¯ helloworld ç¨‹åºçš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="åŠ¨æ‰‹å°è¯•-1"><a class="header" href="#åŠ¨æ‰‹å°è¯•-1">åŠ¨æ‰‹å°è¯•</a></h3>
<pre class="mermaid">graph TD
helloworld --&gt; axhal
</pre>
<p>æˆ‘ä»¬çœ‹åˆ° boot.rs çš„æ±‡ç¼–ä»£ç æœ€åæœ‰ä¸€æ®µè·³è½¬åˆ° entry çš„ä»£ç ï¼Œ ç›®å‰æ¥è¯´ï¼ŒArceOS è¿è¡Œåˆ°è¿™é‡Œä¹‹åï¼Œå°±ä¼šè·³è½¬åˆ° rust_entry å‡½æ•°ï¼ˆåœ¨axhal/src/platform/qemu_virt_riscv/mod.rs æ–‡ä»¶ä¸­ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æµç¨‹ï¼Œç„¶åè°ƒç”¨rust_main å‡½æ•°ï¼ˆåœ¨ modules/axruntime/src/lib.rs æ–‡ä»¶ä¸­ï¼‰ï¼Œ rust_main å‡½æ•°ä¼šæ ¹æ®é€‰æ‹©çš„ feature è¿›è¡Œåˆå§‹åŒ–çš„æµç¨‹ï¼Œ æœ€åä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçš„ main å‡½æ•°ã€‚</p>
<p>ä¸ºé¿å…å¼•å…¥è¿‡å¤šç»„ä»¶ï¼Œ æˆ‘ä»¬ç›´æ¥å°† axhal/src/platform/qemu_virt_riscv/mod.rs é‡Œé¢ rust_entry ä¸­è°ƒç”¨çš„ rust_main() å‡½æ•°æ¢æˆåº”ç”¨ç¨‹åºçš„ main å‡½æ•°(è®°å¾—è¦åœ¨ä¸Šé¢ extern å¼•ç”¨ main å‡½æ•°)ï¼Œ å¹¶åŠ ä¸Šä¸€è¡Œ self::misc::terminate()ï¼Œ æ–¹ä¾¿ arceos è¿è¡Œå®Œç¨‹åºåç»ˆæ­¢ï¼Œä»¥é˜²æ­¢ArceOSå¡æ­»ä¸èƒ½æ­£å¸¸é€€å‡ºï¼ˆç›®å‰é€€å‡ºçš„åŠŸèƒ½ä¾èµ–äºä¸‹ä¸€éƒ¨åˆ†æåˆ°çš„axruntimeç»„ä»¶ï¼‰ã€‚</p>
<p>axhal/src/platform/qemu_virt_riscv/mod.rs</p>
<pre><pre class="playground"><code class="language-rust edition2021">extern &quot;C&quot; {
    fn trap_vector_base();
    fn rust_main(cpu_id: usize, dtb: usize);
    fn main();  // ä»å¤–éƒ¨å¼•å…¥mainå‡½æ•°
    #[cfg(feature = &quot;smp&quot;)]
    fn rust_main_secondary(cpu_id: usize);
}

unsafe extern &quot;C&quot; fn rust_entry(cpu_id: usize, dtb: usize) {
    crate::mem::clear_bss();
    crate::cpu::init_primary(cpu_id);
    crate::arch::set_trap_vector_base(trap_vector_base as usize);
    // rust_main(cpu_id, dtb);
    main();  // è·³è½¬åˆ°åº”ç”¨ç¨‹åºçš„mainå‡½æ•°
    self::misc::terminate();  // ç¨‹åºè¿è¡Œåç»ˆæ­¢
}</code></pre></pre>
<p>æ‰§è¡Œ: </p>
<pre><code class="language-shell">make ARCH=riscv64 A=apps/helloworld run
</code></pre>
<p>å¦‚æ— æ„å¤–ï¼Œ helloworldæˆåŠŸè¾“å‡ºï¼è¯´æ˜æˆ‘ä»¬çš„æ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œå°†è¦è¾“å‡ºçš„å†…å®¹é€šè¿‡ helloworld ä¼ é€’ç»™ axhalï¼Œè¿™æ ·åªéœ€è¦ä¸¤ä¸ªç»„ä»¶å°±èƒ½å®ç°åº”ç”¨ç¨‹åº helloworld çš„è¿è¡Œå’Œè¾“å‡ºã€‚</p>
<p><img src="https://s2.loli.net/2023/07/06/3TNuBdRbEcCAevM.png" alt="image-20230706151516690" /></p>
<h3 id="æ€»ç»“-1"><a class="header" href="#æ€»ç»“-1">æ€»ç»“</a></h3>
<p>å…¶å® helloworld ç¨‹åºæœ¬è´¨è¿˜æ˜¯è°ƒç”¨ axhal çš„ sbi è¾“å‡ºåŠŸèƒ½ï¼ˆå…·ä½“æ­¥éª¤è§ç¬¬ä¸‰éƒ¨åˆ†æµç¨‹å›¾ï¼‰ï¼Œæˆ‘ä»¬æŠŠä¸¤ä¸ªç»„ä»¶ç»“åˆäº†èµ·æ¥ï¼è¿™ä¹Ÿä½“ç°äº† ArceOS çš„æ€æƒ³ï¼Œåªéœ€è¦æŠŠéœ€è¦çš„éƒ¨åˆ†ç»„åˆèµ·æ¥å°±èƒ½å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ã€‚</p>
<h3 id="é™„å½•-1"><a class="header" href="#é™„å½•-1">é™„å½•</a></h3>
<p><a href="https://github.com/rcore-os/arceos/blob/main/apps/helloworld/src/main.rs">helloworldæºä»£ç </a> </p>
<p><a href="https://github.com/rcore-os/arceos/blob/main/doc/apps_helloworld.md">helloworldæ–‡æ¡£</a> </p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="æ·»åŠ -axruntime-ç»„ä»¶æä¾›æ›´å®Œæ•´çš„è¿è¡Œç¯å¢ƒ"><a class="header" href="#æ·»åŠ -axruntime-ç»„ä»¶æä¾›æ›´å®Œæ•´çš„è¿è¡Œç¯å¢ƒ">æ·»åŠ  axruntime ç»„ä»¶æä¾›æ›´å®Œæ•´çš„è¿è¡Œç¯å¢ƒ</a></h2>
<p>ä¹‹æ‰€ä»¥å°† helloworld çš„ main å‡½æ•°å’Œ axhal ç»„åˆèµ·æ¥å°±èƒ½å®ç°è¾“å‡ºåŠŸèƒ½ï¼Œæ˜¯å› ä¸º helloworld åº”ç”¨ç¨‹åºåªç”¨åˆ°äº† axhal æä¾›çš„è£¸æœºè¾“å‡ºåŠŸèƒ½ï¼Œ å¦‚æœæˆ‘ä»¬éœ€è¦æ”¯æŒæ›´å¤æ‚çš„åº”ç”¨ï¼Œaxhal æä¾›çš„ä½çº§çš„è£¸æœºç¯å¢ƒè‚¯å®šä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œ é‚£ä¹ˆå°±éœ€è¦ç”¨åˆ° axruntime è¿™ä¸ªæ›´å¼ºå¤§çš„ç»„ä»¶äº†ã€‚</p>
<p>axruntime çš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨è¿›å…¥åº”ç”¨ç¨‹åºçš„ main å‡½æ•°ä¹‹å‰æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ æ ¹æ®æ‰€é€‰æ‹©çš„ä¸åŒ feature æ‰§è¡Œç›¸å¯¹åº”çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ </p>
<pre class="mermaid">graph TD
helloworld --&gt; axruntime --&gt; axhal
</pre>
<p>åœ¨è¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ ArceOS çš„æºä»£ç ï¼Œå°†ä¹‹å‰ä¿®æ”¹çš„ä»£ç è¿˜åŸï¼Œåœ¨ axhal æ‰§è¡Œå®Œåä¸æ˜¯ç›´æ¥è·³è½¬åˆ°åº”ç”¨ç¨‹åºçš„ main å‡½æ•°ï¼Œ è€Œæ˜¯è·³è½¬åˆ° axruntime è¿™ä¸ªç»„ä»¶çš„ rust_main å‡½æ•°ï¼Œå†è·³è½¬åˆ° helloworld çš„ main å‡½æ•°ã€‚</p>
<h3 id="åŠ¨æ‰‹å°è¯•-2"><a class="header" href="#åŠ¨æ‰‹å°è¯•-2">åŠ¨æ‰‹å°è¯•</a></h3>
<p>è¿è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="language-shell">make ARCH= riscv64 A=apps/helloworld run LOG=debug
</code></pre>
<p>è¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼Œä¸‹é¢çš„è°ƒè¯•è¾“å‡ºä¿¡æ¯ç»¿è‰²å­—ä½“éƒ¨åˆ†å¯ä»¥ä¸ºæˆ‘ä»¬ç›´è§‚åœ°å±•ç¤º axruntime åšçš„ä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚</p>
<p><img src="https://s2.loli.net/2023/07/07/5j7mDSt3oNqMHyd.png" alt="image-20230707100119498" /></p>
<p>æœ‰äº†è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½è¿è¡Œ helloworld è¿™æ ·çš„ç®€å•ç¨‹åºï¼Œè¿˜èƒ½è¿è¡Œç¨å¾®å¤æ‚ä¸€äº›çš„ç¨‹åºã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿è¡Œ yield åº”ç”¨ç¨‹åº (FIFO scheduler): </p>
<pre><code class="language-shell">make A=apps/task/yield ARCH=riscv64 LOG=info NET=y SMP=1 run
</code></pre>
<p>è¿è¡Œç»“æœ: </p>
<p><img src="https://s2.loli.net/2023/07/07/OgBFrv8T1bmjEnG.png" alt="image-20230707143841246" /></p>
<h3 id="è¿è¡Œè¿‡ç¨‹åˆ†æ"><a class="header" href="#è¿è¡Œè¿‡ç¨‹åˆ†æ">è¿è¡Œè¿‡ç¨‹åˆ†æ</a></h3>
<p>è®©æˆ‘ä»¬é€šè¿‡æµç¨‹å›¾çœ‹çœ‹ ArceOS çš„è¿è¡ŒèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<p>ç¬¬ä¸€æ­¥æ˜¯ä¸€äº›åˆå§‹åŒ–å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p>
<h4 id="step-1"><a class="header" href="#step-1">Step 1</a></h4>
<pre class="mermaid">graph TD;
    A[axhal::platform::qemu_virt_riscv::boot.rs::_boot] --&gt; init_boot_page_table;
    A --&gt; init_mmu;
    A --&gt; P[platform_init];
    A --&gt; B[axruntime::rust_main];
    P --&gt; P1[&quot;axhal::mem::clear_bss()&quot;];
    P --&gt; P2[&quot;axhal::arch::riscv::set_trap_vector_base()&quot;];
    P --&gt; P3[&quot;axhal::cpu::init_percpu()&quot;];
    P --&gt; P4[&quot;axhal::platform::qemu_virt_riscv::irq.rs::init()&quot;];
    P --&gt; P5[&quot;axhal::platform::qemu_virt_riscv::time.rs::init()&quot;];
    B --&gt; axlog::init;
    B --&gt; D[init_allocator];
    B --&gt; remap_kernel_memory;
    B --&gt; axtask::init_scheduler;
    B --&gt; axdriver::init_drivers;
    B --&gt; Q[axfs::init_filesystems];
    B --&gt; axnet::init_network;
    B --&gt; axdisplay::init_display;
    B --&gt; init_interrupt;
    B --&gt; mp::start_secondary_cpus;
    B --&gt; C[main];
    Q --&gt; Q1[&quot;disk=axfs::dev::Disk::new()&quot;];
    Q --&gt; Q2[&quot;axfs::root::init_rootfs(disk)&quot;];
    Q2 --fatfs--&gt; Q21[&quot;main_fs=axfs::fs::fatfs::FatFileSystem::new()&quot;];
    Q2 --&gt; Q22[&quot;MAIN_FS.init_by(main_fs); MAIN_FS.init()&quot;];
    Q2 --&gt; Q23[&quot;root_dir = RootDirectory::new(MAIN_FS)&quot;];
    Q2 --devfs--&gt; Q24[&quot;axfs_devfs::DeviceFileSystem::new()&quot;];
    Q2 --devfs--&gt; Q25[&quot;devfs.add(null, zero, bar)&quot;];
    Q2 --&gt;Q26[&quot;root_dir.mount(devfs)&quot;];
    Q2 --&gt;Q27[&quot;init ROOT_DIR, CURRENT_DIR&quot;];
    D --&gt; E[&quot;In free memory_regions: axalloc::global_init&quot;];
    D --&gt; F[&quot;In free memory_regions:  axalloc::global_add_memory&quot;];
    E --&gt; G[axalloc::GLOBAL_ALLOCATOR.init];
    F --&gt; H[axalloc::GLOBAL_ALLOCATOR.add_memory];
    G --&gt; I[&quot;PAGE: self.palloc.lock().init&quot;];
    G --&gt; J[&quot;BYTE: self.balloc.lock().init&quot;];
    H --&gt; K[&quot;BYTE: self.balloc.lock().add_memory&quot;];
    I --&gt; M[&quot;allocator::bitmap::BitmapPageAllocator::init()&quot;];
    J --&gt;L[&quot;allocator::slab::SlabByteAllocator::init() self.inner = unsafe { Some(Heap::new(start, size))&quot;];
    K --&gt; N[&quot;allocator::slab::SlabByteAllocator::add_memory:  self.inner_mut().add_memory(start, size);&quot;];


</pre>
<p>ä¸‹é¢æ˜¯ helloworld ç¨‹åºçš„è¿è¡Œæµç¨‹ï¼Œå®é™…ä¸Š helloworld ç¨‹åºæœ€åè°ƒç”¨çš„æ˜¯ axhal å°è£…å¥½çš„è¾“å‡ºåŠŸèƒ½ï¼Œæœ¬è´¨è¿˜æ˜¯ä¾é  sbi è¿›è¡Œè¾“å‡ºã€‚</p>
<h4 id="step-2"><a class="header" href="#step-2">Step 2</a></h4>
<pre class="mermaid">graph TD;
    A[main] --&gt; B[&quot;libax::println!(Hello, world!)&quot;];
    B --&gt; C[libax:io::__print_impl];
    C --&gt; D[INLINE_LOCK=Mutex::new];
    C --&gt; _guard=INLINE_LOCK.lock;
    C --&gt; E[&quot;stdout().write_fmt(args)&quot;];
</pre>
<h5 id="step-21"><a class="header" href="#step-21">step 2.1</a></h5>
<pre class="mermaid">graph TD;
    T[&quot;stdout()&quot;] --&gt; A[&quot;libax::io::stdio.rs::stdout()&quot;];
    A --&gt; B[&quot;INSTANCE: Mutex&lt;StdoutRaw&gt; = Mutex::new(StdoutRaw)&quot;];
    A --&gt; C[&quot;return Stdout { inner: &amp;INSTANCE }&quot;];
</pre>
<h5 id="step-22"><a class="header" href="#step-22">step 2.2</a></h5>
<pre class="mermaid">graph TD;
    T[&quot;stdout().write_fmt(args)&quot;] --&gt; A[&quot;Stdout::write&quot;];
    A --&gt; B[&quot;self.inner.lock().write(buf)&quot;];
    B --&gt; C[&quot;StdoutRaw::write&quot;];
    C --&gt; D[&quot;axhal::console::write_bytes(buf);&quot;];
    C --&gt; E[&quot;Ok(buf.len())&quot;];
    D --&gt; F[&quot;putchar&quot;];
    F --&gt; G[&quot;axhal::platform::qemu_virt_riscv::console::putchar&quot;];
    G --&gt; H[&quot;sbi_rt::legacy::console_putchar&quot;];
</pre>
<h3 id="æ€»ç»“-2"><a class="header" href="#æ€»ç»“-2">æ€»ç»“</a></h3>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä» axhal åˆ° axruntime åˆ° helloworld çš„ç»„åˆäº†ï¼Œå¹¶ä¸”å°† helloworld unikernel è¿è¡Œäº†èµ·æ¥ã€‚</p>
<h3 id="é™„å½•-2"><a class="header" href="#é™„å½•-2">é™„å½•</a></h3>
<ul>
<li>
<p><code>axruntime</code> æ¨¡å—ç®€ä»‹ï¼š</p>
</li>
<li>
<p>æ¨¡å—æºç ä½ç½®ï¼š<a href="(https://github.com/rcore-os/arceos/tree/main/modules/axruntime)">modules/axruntime</a></p>
<ul>
<li>åŠŸèƒ½æè¿°ï¼šåœ¨è¿›å…¥åº”ç”¨ç¨‹åºçš„ main å‡½æ•°ä¹‹å‰æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œ æ ¹æ®æ‰€é€‰æ‹©çš„ feature æ‰§è¡Œç›¸å¯¹åº”çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li>
</ul>
</li>
<li>
<p>æµç¨‹å›¾æ¥æºï¼š</p>
<ul>
<li>
<p>step 1 <a href="https://github.com/rcore-os/arceos/blob/main/doc/init.md">init</a></p>
</li>
<li>
<p>step 2 <a href="https://github.com/rcore-os/arceos/blob/main/doc/apps_helloworld.md">helloworld</a></p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ç”±å¼€å¯åŠ¨æ€å†…å­˜åˆ†é…ç‰¹æ€§æ¥åˆè¯†ç³»ç»Ÿç›¸å…³å’Œæ— å…³"><a class="header" href="#ç”±å¼€å¯åŠ¨æ€å†…å­˜åˆ†é…ç‰¹æ€§æ¥åˆè¯†ç³»ç»Ÿç›¸å…³å’Œæ— å…³">ç”±å¼€å¯åŠ¨æ€å†…å­˜åˆ†é…ç‰¹æ€§æ¥åˆè¯†ç³»ç»Ÿç›¸å…³å’Œæ— å…³</a></h2>
<h3 id="å‰ä¸‰ä¸ªé˜¶æ®µæ€»ç»“"><a class="header" href="#å‰ä¸‰ä¸ªé˜¶æ®µæ€»ç»“">å‰ä¸‰ä¸ªé˜¶æ®µæ€»ç»“</a></h3>
<p>åœ¨ä¹‹å‰çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä»¥å‘å±å¹•æ‰“å°â€œhello worldâ€ä¸ºç›®æ ‡ï¼Œç”±ç®€å…¥ç¹ï¼Œå…±ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼š</p>
<p>ç¬¬ä¸€é˜¶æ®µï¼Œâ€œæœªæœ‰å¤©åœ°ä¹‹æ—¶ï¼Œæ··æ²ŒçŠ¶å¦‚é¸¡å­â€ï¼Œæ„å»ºä¸€ä¸ªå¯ä»¥ä¸ç¡¬ä»¶äº¤äº’çš„æœ€å°è¿è¡Œç¯å¢ƒ axhalï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œæˆ‘ä»¬åœ¨å®Œæˆå¼•å¯¼å’Œå¿…è¦åŠŸèƒ½åˆå§‹åŒ–ä¹‹åå°±å¯ä»¥ç›´æ¥è°ƒç”¨å¯¹åº”å¹³å°çš„æ±‡ç¼–æŒ‡ä»¤æ¥å®ç°æ‰“å° helloworld çš„åŠŸèƒ½ï¼Œæ­¤æ—¶ç”¨æˆ·æ‰€éœ€åŠŸèƒ½ï¼ˆå‘å±å¹•æ‰“å°â€œhello worldâ€ï¼‰å’Œè¿è¡Œæ—¶ç¯å¢ƒæ˜¯æ··åˆåœ¨ä¸€èµ·çš„ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µï¼Œâ€œæ¸…è½»è€…ä¸Šå‡ä¸ºå¤©ï¼Œé‡æµŠè€…ä¸‹é™ä¸ºåœ°â€ï¼Œä¸Šä¸€é˜¶æ®µçš„ç¨‹åºåˆ†è£‚æˆ axhal+helloworldï¼Œ å°è¯•å°†æ‰“å° helloworld åŠŸèƒ½è¿›è¡Œåˆ†ç¦»å¹¶æ‰©å±•ï¼Œä»¤ helloworld æ‰©å±•æˆä¸€ä¸ªç‹¬ç«‹çš„ appã€‚è¯¥é˜¶æ®µéœ€è¦å®šä¹‰ç¨‹åºå…¥å£ï¼Œæˆ‘ä»¬å°è¯•åœ¨ axhal ä¸­è®¾ç½®å…¥å£ç‚¹ï¼Œä»¤ axhal ç»è¿‡å¼•å¯¼ä¹‹åç›´æ¥è·³è½¬åˆ° helloworld ä¸­æ‰§è¡Œç›¸åº”åŠŸèƒ½ã€‚</p>
<p>ç¬¬ä¸‰é˜¶æ®µï¼Œâ€œå¤©ç”Ÿæ—¥æœˆæ˜Ÿè¾°ï¼Œåœ°ç”Ÿå±±å·è‰æœ¨â€ï¼Œç¬¬äºŒé˜¶æ®µçš„ä¸¤ä¸ªæ¨¡å—è¿›ä¸€æ­¥åˆ†è£‚å¹¶æ‰©å±•ä¸º axhal+axruntime+helloworldï¼Œæˆ‘ä»¬ä¸æ»¡è¶³äºç”¨æˆ·ç›´æ¥åŸºäº axhal æä¾›çš„ä½çº§çš„è£¸ç¯å¢ƒæ¥è¿›è¡Œå¼€å‘ï¼Œæ‰€ä»¥å°† axhal åŒ…è£…å¹¶æ‰©å±•æˆ axruntime æ¥æä¾›å„ç§è¿è¡Œæ—¶å¿…è¦ç»„ä»¶ï¼Œå’Œ axhal ç›¸æ¯”ï¼Œaxruntime æ©ç›–äº†ä¸åº•å±‚ç¡¬ä»¶äº¤äº’çš„å¤æ‚åŸç†ï¼Œæ­¤æ—¶ helloworld çš„è¿è¡Œç¯å¢ƒç”±ç›´æ¥ä¾èµ–äº axhal å˜æˆäº†æ›´ä¸ºé«˜çº§æ›´ä¸ºå¼ºå¤§çš„ axruntimeã€‚</p>
<h3 id="ç³»ç»Ÿæ— å…³å’Œç³»ç»Ÿç›¸å…³"><a class="header" href="#ç³»ç»Ÿæ— å…³å’Œç³»ç»Ÿç›¸å…³">ç³»ç»Ÿæ— å…³å’Œç³»ç»Ÿç›¸å…³</a></h3>
<p>å¯ä»¥è¯´åœ¨ä¹‹å‰çš„éƒ¨åˆ†ä¸­ï¼Œå°±å·²ç»å¾ˆå¥½çš„ä½“ç°å‡º ArceOS å½¢å¦‚ç»†èƒä¸€æ ·çš„å¼ºå¤§åˆ†è£‚å’Œæ‰©å±•çš„åŠŸèƒ½ã€‚å‰ä¸‰ä¸ªé˜¶æ®µæ‰“å°åˆ°å±å¹•çš„æ–‡å­—çš„å®é™…å­˜å‚¨ä½ç½®ä½äº .text æ®µï¼Œç”±åº•å±‚è¿è¡Œç¯å¢ƒè¿›è¡Œé™æ€åˆ†é…å¹¶ç®¡ç†çš„ï¼Œè¿™ç§ç®¡ç†æ–¹å¼çš„ä¼˜åŠ¿æ˜¯å¼€é”€å°ï¼Œæ€§èƒ½é«˜ï¼Œç¼ºç‚¹æ˜¯çµæ´»æ€§ä¸è¶³ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³å°è¯•ä½¿ç”¨åŠ¨æ€åˆ†é…çš„ç±»å‹æ€ä¹ˆåŠï¼Ÿå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª String ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡ println çš„æ ¼å¼åŒ–åŠŸèƒ½å°†ç»„è£…åçš„å­—ç¬¦ä¸²æ‰“å°åˆ°å±å¹•ã€‚è¿™ä¸ªåŠŸèƒ½åº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<p>è¿›ä¸€æ­¥åˆ†æä¸Šè¿°çš„éœ€æ±‚ï¼Œå‘ç°æˆ‘ä»¬çš„ç›®çš„å…¶å®æ˜¯æ“ä½œç³»ç»Ÿ ArceOS ä¸ºç”¨æˆ·çš„åº”ç”¨ç¨‹åº helloworld æä¾›å†…å­˜åˆ†é…æ”¯æŒï¼Œé‚£ä¹ˆå¦‚ä½•ä¼˜é›…åœ°ä¸ºç”¨æˆ·æä¾›è¿™ç§æ”¯æŒæˆäº†æˆ‘ä»¬ç›®å‰é¦–è¦çš„ç›®æ ‡ã€‚</p>
<p>å›æƒ³ä¸€ä¸‹ä¸Šä¸€ä¸ªç« å¯¹ Unikernel è¿™ä¸ªæ¦‚å¿µçš„è®²è§£ï¼Œæ“ä½œç³»ç»Ÿç§ç±»ç¹å¤šï¼Œä½†æ˜¯é€šè¿‡å°†å„ä¸ªåŠŸèƒ½è¿›è¡Œæ·±å…¥æ‹†åˆ†å’Œç½—åˆ—ï¼Œå‘ç°æ”¯æ’‘æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½æ¨¡å—å…¶å®æœ‰å…±æ€§å¯è¨€ï¼Œæ¯”å¦‚ä¸€ä¸ªæ“ä½œç³»ç»Ÿæƒ³è¦å®ç°å¤šä¸ªä»»åŠ¡åˆ‡æ¢ï¼Œé‚£è¿™ä¸ªæ“ä½œç³»ç»Ÿä¸€å®šè¦æ¶‰åŠåˆ°ä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰çš„è°ƒåº¦ç®—æ³•ï¼Œè€Œè¿™ç§å¯ä»¥åˆ†ç¦»æˆå•ç‹¬çš„æ¨¡å—ç”šè‡³å¯ä»¥è¢«å…¶ä»–æ“ä½œç³»ç»Ÿæ‰€å¤ç”¨çš„ç‰¹ç‚¹ï¼Œåœ¨ ArceOS çš„è®¾è®¡ä½“ç³»ä¸­æˆ‘ä»¬ç§°ä¹‹ä¸ºç³»ç»Ÿæ— å…³ï¼›è€Œç›¸åï¼Œå‰é¢æ¶‰åŠåˆ°çš„ axhal å’Œ axruntimeï¼Œæ˜¯ ArceOS æœ¬èº«åˆ©ç”¨ç³»ç»Ÿæ— å…³çš„ç»„ä»¶ä¸ºç”¨æˆ·ç¨‹åºæ‰“é€ è¿è¡Œæ—¶ç¯å¢ƒçš„ç‰¹å®šå®ç°æ–¹å¼ï¼Œè¿™ç§ç»„åˆæ‰©å±•æ–¹å¼æ˜¯ä¸åŒäºå…¶ä»–æ“ä½œç³»ç»Ÿçš„ã€‚æ‰€ä»¥è¿™ç±»æ¨¡å—æˆ‘ä»¬ç§°å…¶ä¸ºç³»ç»Ÿç›¸å…³ï¼Œä»£è¡¨äº†æ“ä½œç³»ç»Ÿé€šè¿‡ç³»ç»Ÿæ— å…³ç»„ä»¶æ¥æ‰“é€ ç”¨æˆ·ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç‹¬ç‰¹æ–¹å¼ï¼Œæ— æ³•è¢«å…¶ä»–ç³»ç»Ÿæ‰€å¤ç”¨ã€‚</p>
<p>å…·ä½“åˆ° ArceOS çš„æºç ç»„æˆéƒ¨åˆ†æ¥çœ‹ï¼Œç›®å‰ crates æ–‡ä»¶å¤¹ä¸‹çš„æ¨¡å—å±äºæ˜¯ç³»ç»Ÿæ— å…³çš„æ¨¡å—ï¼Œè¿™äº›åº“å¯ä»¥ç†è§£ä¸ºæ„å»ºä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€éœ€è¦çš„åº•å±‚å…±æ€§ï¼Œæˆ‘ä»¬ä»¥æ¾è€¦åˆï¼Œé«˜æŠ½è±¡çš„æ–¹å¼å¼€å‘è¿™äº›åº“ï¼Œç›®çš„æ˜¯åç»­å¯ä»¥ä¸ºåˆ«çš„ç³»ç»Ÿå¤ç”¨ã€‚modules ä¸‹çš„æ¨¡å—æ˜¯ ArceOS ä¸ºäº†æƒ³è¦å®ç°æ“ä½œç³»ç»Ÿçš„å¿…è¦åŠŸèƒ½è€Œå¯¹ crates çš„å„ç§åº“ç»„åˆå’Œæ‰©å±•åï¼Œæ›´åŠ æ¥è¿‘ç”¨æˆ·åº”ç”¨å±‚çš„æŠ½è±¡æ¨¡å—ã€‚</p>
<h3 id="åŠ¨æ‰‹å°è¯•-3"><a class="header" href="#åŠ¨æ‰‹å°è¯•-3">åŠ¨æ‰‹å°è¯•</a></h3>
<p>â€‹è®²è§£å®Œè¿™ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œå›åˆ°åŠ¨æ€åˆ†é…å†…å­˜è¿™ä¸ªä¸»é¢˜ä¸Šï¼Œæ ¹æ®ä¹‹å‰åˆ†ç±»çš„æ ‡å‡†ï¼Œå¾ˆå®¹æ˜“å‘ç°åŠ¨æ€åˆ†é…ç‰¹æ€§æ˜¯å±äºç³»ç»Ÿæ— å…³çš„ï¼ŒåŸºäºä¹‹å‰çš„è°ƒç”¨ä¾èµ–å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ›´æ–°ä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<pre class="mermaid">graph TD
    helloworld--&gt;modules;
    subgraph modules;
    axruntime--&gt;axhal;
    end
    modules--&gt;crates;
    subgraph crates;
    allocator;
    end
</pre>
<p>è¿™é‡Œæˆ‘ä»¬ç®€åŒ–äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰æ¶‰åŠåˆ°å…¶ä»–è¾…åŠ©ç±»çš„æ¨¡å—çš„å±•ç¤ºï¼Œåªå±•ç¤ºäº†å¿…è¦çš„åŠŸèƒ½ä¾èµ–é“¾ã€‚</p>
<p>å…·ä½“ä½“ç°åœ¨ä»£ç ä¸­ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ä¿®æ”¹ apps/helloworld/Cargo.tomlï¼Œæ·»åŠ å¼€å¯åŠ¨æ€å†…å­˜åˆ†é…çš„ç‰¹æ€§ï¼š</p>
<pre><code class="language-toml">[dependencies]
libax = { path = &quot;../../ulib/libax&quot;, features=[&quot;alloc&quot;]} #å°è¯•æ·»åŠ åŠ¨æ€åˆ†é…å†…å­˜çš„feature
</code></pre>
<p>ä¹‹åï¼Œæˆ‘ä»¬ä¿®æ”¹ apps/helloworld/src/main.rsï¼Œå°è¯•ä½¿ç”¨ alloc ç‰¹æ€§æä¾›çš„åŠ¨æ€åˆ†é…å†…å­˜åŠŸèƒ½ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">#![no_std]
#![no_main]

use libax::println;
<span class="boring">ä¸º helloworld æä¾›å¯ä»¥åŠ¨æ€å†…å­˜åˆ†é…çš„å­—ç¬¦ä¸²ç±»å‹
</span>use libax::string::String;

#[no_mangle]
fn main() {
<span class="boring">	å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª String å­—ç¬¦ä¸²
</span>    let s = String::from(&quot;I am ArceOS!&quot;);
    println!(&quot;Hello, world! {}&quot;, s);
}</code></pre></pre>
<p>è¿è¡Œ<code>make A=apps/helloworld ARCH=riscv64 LOG=info run</code>ï¼Œæ­¤æ—¶è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/07/08/12879bc9837566bb.png" alt="" /></p>
<p>æ‰“å°å‡ºâ€Hello world! I am ArceOS&quot;ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸä¸º helloworld æä¾›äº†åŠ¨æ€å†…å­˜åˆ†é…åŠŸèƒ½ã€‚</p>
<h3 id="æ€»ç»“-3"><a class="header" href="#æ€»ç»“-3">æ€»ç»“</a></h3>
<p>å…¶å®åƒè¿™ç§ ArceOS åœ¨ç”¨æˆ·çœ‹ä¸è§çš„åœ°æ–¹æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„ç‰¹æ€§éœ€æ±‚ï¼Œç»„è£…å¹¶æ‰©å±•å„ç§æ¨¡å—æä¾›å®šåˆ¶çš„è¿è¡Œç¯å¢ƒï¼Œå…¶å®å°±æ˜¯ ArceOS çš„ç»„ä»¶åŒ–è¿ä½œçš„æ ¸å¿ƒæœºåˆ¶ã€‚æˆ‘ä»¬ä»æœ€ç®€å•çš„ helloworld ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ç‰¹æ€§å‡ºå‘ï¼Œâ€œçª¥ä¸€æ–‘è€ŒçŸ¥å…¨è±¹â€ï¼Œæ¥è§¦åŠ ArceOS çš„æ ¸å¿ƒè¿ä½œæœºåˆ¶ã€‚åœ¨åç»­çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šä¸ºè¯»è€…å±•ç¤º ArceOS æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå…¶åŠŸèƒ½è¿ä½œçš„åŸºæœ¬åŸç†å’Œ helloworld æ˜¯å¤§ä½“ç›¸ä¼¼çš„ï¼Œç›¸ä¿¡è¯»è€…ç†è§£äº†è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œåç»­ç« èŠ‚ç†è§£èµ·æ¥ä¼šæ›´ä¸ºé¡ºç•…ä¸€äº›ã€‚</p>
<h3 id="é™„å½•-3"><a class="header" href="#é™„å½•-3">é™„å½•</a></h3>
<p><code>allocator</code> æ¨¡å—ç®€ä»‹ï¼š</p>
<p>æ¨¡å—æºç ä½ç½®ï¼š<a href="https://github.com/rcore-os/arceos/tree/main/crates/allocator">crates/allocator</a></p>
<p>åŠŸèƒ½æè¿°ï¼š <code>allocator</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨äºå®ç°ä¸åŒç±»å‹çš„å†…å­˜åˆ†é…å™¨ç®—æ³•ã€‚è¯¥æ¨¡å—å…±åŒ…æ‹¬ä¸‰ç§ä¸åŒç±»å‹çš„åˆ†é…å™¨ï¼šå­—èŠ‚ç²’åº¦å†…å­˜åˆ†é…å™¨ (<code>ByteAllocator</code>)ã€é¡µç²’åº¦å†…å­˜åˆ†é…å™¨ (<code>PageAllocator</code>) å’Œå”¯ä¸€ ID åˆ†é…å™¨ (<code>IdAllocator</code>)ã€‚æ¯ç§åˆ†é…å™¨éƒ½æœ‰å…¶ç‰¹å®šçš„å®ç°æ–¹å¼ï¼Œä¾‹å¦‚ <code>BuddyByteAllocator</code> å’Œ <code>SlabByteAllocator</code> å¯¹åº”çš„æ˜¯å­—èŠ‚ç²’åº¦å†…å­˜åˆ†é…å™¨ï¼Œè€Œ <code>BitmapPageAllocator</code> å¯¹åº”çš„æ˜¯é¡µç²’åº¦å†…å­˜åˆ†é…å™¨ã€‚è¿™ä¸ªæ¨¡å—ä½¿å¾—ä¸åŒçš„å†…å­˜åˆ†é…å™¨å¯ä»¥æ›´åŠ çµæ´»åœ°ç»„åˆå’Œæ›¿æ¢ï¼Œå®ç°æ›´åŠ é«˜æ•ˆå’Œå¯é çš„å†…å­˜ç®¡ç†åŠŸèƒ½ã€‚</p>
<p>ArceOS è®¾è®¡æ€æƒ³æ¨èé˜…è¯»ï¼š<a href="https://github.com/chyyuu/thoughts/blob/main/tangram-oskits.md">åƒå¼€å‘åº”ç”¨ä¸€æ ·å¼€å‘æ“ä½œç³»ç»Ÿ</a></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ä¿®æ”¹å‘½ä»¤å®ç°å¯¹featuresçš„ç»†ç²’åº¦æ§åˆ¶"><a class="header" href="#ä¿®æ”¹å‘½ä»¤å®ç°å¯¹featuresçš„ç»†ç²’åº¦æ§åˆ¶">ä¿®æ”¹å‘½ä»¤å®ç°å¯¹featuresçš„ç»†ç²’åº¦æ§åˆ¶</a></h2>
<h3 id="åŠ¨æ‰‹å°è¯•-4"><a class="header" href="#åŠ¨æ‰‹å°è¯•-4">åŠ¨æ‰‹å°è¯•</a></h3>
<p>è¿™éƒ¨åˆ†è®²çš„æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹è¿è¡Œå‘½ä»¤çš„å†…å®¹ï¼Œæ¥è¿›ä¸€æ­¥ç»†ç²’åº¦çš„æ§åˆ¶ç‰¹æ€§ï¼Œè¿™ä¸ªéƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œè¯»è€…å¯ä»¥å¾ˆè½»æ¾åœ°å®Œæˆã€‚</p>
<p>ä»¥å‘å±å¹•æ‰“å°æ—¥å¿—ä¿¡æ¯ä¸ºä¾‹ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹æ—¥å¿—çš„è¿‡æ»¤ç­‰çº§ï¼Œä¾‹å¦‚ï¼Œå±•ç¤ºå‡º warn çº§ä»¥ä¸Šçš„æ—¥å¿—ï¼ˆinfo æ—¥å¿—ä¸ä¼šæ‰“å°åˆ°å±å¹•ä¸Šï¼‰ï¼Œå¯ä»¥ä¿®æ”¹åŸæ¥çš„è¿è¡Œå‘½ä»¤ï¼Œè¿™é‡Œè¿˜æ˜¯ä»¥ qemu risv64 å¹³å°ä¸ºä¾‹ï¼ŒåŸå§‹å‘½ä»¤ä¸ºï¼š</p>
<pre><code class="language-bash">make A=apps/helloworld ARCH=riscv64 LOG=info run
</code></pre>
<p>å°è¯•è¿è¡Œä¸€ä¸‹ï¼Œå‘ç° info ä»¥ä¸Šçº§åˆ«çš„æ—¥å¿—ä¼šè¢«æ‰“å°å‡ºæ¥ï¼ˆæç¤ºï¼šç»¿è‰²å­—ä½“æ‰€åœ¨è¡Œä¸º info çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼‰ï¼š</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/07/08/70bcb2d5d8955ed2.png" alt="" /></p>
<p>å¦‚æœä¿®æ”¹ log æ—¥å¿—ç­‰çº§ï¼š</p>
<pre><code class="language-bash">make A=apps/helloworld ARCH=riscv64 LOG=warn run
</code></pre>
<p>æ­¤æ—¶èƒ½å¤Ÿå±•ç¤ºæ—¥å¿—çš„æœ€ä½çº§åˆ«æé«˜åˆ° warnï¼Œä¹‹å‰ info çº§åˆ«çš„æ—¥å¿—ä¸ä¼šè¢«æ‰“å°åˆ°å±å¹•ä¸­ï¼Œå°è¯•è¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/07/08/ff2b0cf439009c81.png" alt="" /></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¹‹å‰å±•ç¤ºå‡ºæ¥ç»¿è‰²å­—ä½“çš„ info æ—¥å¿—è¡Œéƒ½æ¶ˆå¤±äº†ã€‚</p>
<h3 id="å®ç°åŸç†"><a class="header" href="#å®ç°åŸç†">å®ç°åŸç†</a></h3>
<p>feature çš„å‚æ•°æ§åˆ¶ä¹Ÿæ˜¯ ArceOS çš„å¼ºå¤§åŠŸèƒ½ä¹‹ä¸€ï¼Œå’Œä¹‹å‰çš„éƒ¨åˆ†ä¸åŒï¼Œç”¨æˆ·ä»å¼€å¯æˆ–å…³é—­ feature å˜æˆäº†å…·ä½“è°ƒæ•´ feature ç‰¹æ€§çš„å‚æ•°ï¼Œä»¥è¾¾åˆ°è‡ªå·±æ‰€éœ€è¦çš„æœ€ä½³ç¯å¢ƒæ”¯æŒã€‚ç”¨æˆ·é€šè¿‡è¿è¡Œå‘½ä»¤æ¥è°ƒæ•´ feature çš„æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼š</p>
<pre class="mermaid">graph TD
	Client--&gt;|features|helloworld
    helloworld--&gt;|features|modules;
    subgraph modules;
    axruntime--&gt;axhal;
    end
    modules--&gt;crates;
    subgraph crates;
    allocator;
    end
</pre>
<p>ç»“åˆå›¾ä¸­å±•ç¤ºå’Œå…·ä½“å®ç°éƒ¨åˆ†ï¼Œç”¨æˆ· (Client) é€šè¿‡å‘½ä»¤ä¼ é€’æƒ³è¦æ§åˆ¶çš„å‚æ•°ï¼Œè‡ªé¡¶å¾€ä¸‹ç”± helloworld ä¼ é€’åˆ° modulesï¼Œæœ€ç»ˆæŠµè¾¾ modules/axruntime/src/lib.rs(123 è¡Œ)<code>axlog::set_max_level(option_env!(&quot;LOG&quot;).unwrap_or(&quot;&quot;));</code>è¿™è¡Œä»£ç , æ¥æ”¶ç”¨æˆ·åœ¨å‘½ä»¤ä¸Šè®¾ç½®çš„<code>LOG</code>æ§åˆ¶å‚æ•°æ¥å®ç°å¯¹æ—¥å¿—è¿‡æ»¤ç­‰çº§çš„æ§åˆ¶ã€‚</p>
<h3 id="æ€»ç»“-4"><a class="header" href="#æ€»ç»“-4">æ€»ç»“</a></h3>
<p>ç”¨æˆ·é€šè¿‡å‘½ä»¤è¿›è¡Œå…¶ä»–å‚æ•°æ§åˆ¶ä¹Ÿç»å†ç±»ä¼¼äº LOG çš„ feature ä¼ é€’ï¼Œç„¶åæŠµè¾¾çœŸæ­£çš„å®ç°ä½ç½®ï¼Œå°†ç”¨æˆ·è®¾ç½®åº”ç”¨åˆ°ç³»ç»Ÿä¸Šã€‚è™½ç„¶å¯èƒ½è‡ªé¡¶å‘ä¸‹çš„å¯»æ‰¾è·¯çº¿ä¸åŒï¼ˆéœ€è¦è¾¾åˆ° ä¸åŒ feature å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼‰ï¼Œæ‰€éœ€è¦çš„è·¯å¾„é•¿çŸ­ä¸åŒï¼ˆè¦æ§åˆ¶çš„ feature å¯èƒ½éœ€è¦å’Œç¡¬ä»¶é©±åŠ¨è¿›è¡Œäº¤äº’ï¼‰ï¼Œä½†æ˜¯æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯ä¸€è‡´çš„ã€‚å¯ä»¥ç±»æ¯”ä¸ºç”¨æˆ·æ˜¯ä¸€ä¸ªæ“æ§è€…ï¼Œé€šè¿‡æ‰‹ä¸­çš„çº¿ï¼ˆfeature å‘½ä»¤å‚æ•°ï¼‰æ¥æ§åˆ¶æœ¨å¶ï¼ˆArceOSï¼‰æ¥è¾¾åˆ°ä»–æƒ³è¦çš„å±•ç¤ºåŠ¨ä½œï¼ˆè¿è¡Œç¯å¢ƒï¼‰ã€‚</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/07/09/1f9a24064eb6d6db.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="è®¾è®¡å®ç°åä½œå¼å¤šä»»åŠ¡unikernel"><a class="header" href="#è®¾è®¡å®ç°åä½œå¼å¤šä»»åŠ¡unikernel">è®¾è®¡å®ç°åä½œå¼å¤šä»»åŠ¡unikernel</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="åä½œå¼å¤šä»»åŠ¡çš„åŠŸèƒ½éœ€æ±‚"><a class="header" href="#åä½œå¼å¤šä»»åŠ¡çš„åŠŸèƒ½éœ€æ±‚">åä½œå¼å¤šä»»åŠ¡çš„åŠŸèƒ½éœ€æ±‚</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="åä½œå¼å¤šä»»åŠ¡ç›¸å…³çš„cratesmodulesç»„æˆ"><a class="header" href="#åä½œå¼å¤šä»»åŠ¡ç›¸å…³çš„cratesmodulesç»„æˆ">åä½œå¼å¤šä»»åŠ¡ç›¸å…³çš„crates/modulesç»„æˆ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="åä½œå¼å¤šä»»åŠ¡çš„æ¡†æ¶è®¾è®¡"><a class="header" href="#åä½œå¼å¤šä»»åŠ¡çš„æ¡†æ¶è®¾è®¡">åä½œå¼å¤šä»»åŠ¡çš„æ¡†æ¶è®¾è®¡</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ç»„è£…åä½œå¼å¤šä»»åŠ¡unikernel"><a class="header" href="#ç»„è£…åä½œå¼å¤šä»»åŠ¡unikernel">ç»„è£…åä½œå¼å¤šä»»åŠ¡unikernel</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
